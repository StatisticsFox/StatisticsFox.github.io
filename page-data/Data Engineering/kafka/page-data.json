{"componentChunkName":"component---src-templates-blog-template-js","path":"/Data Engineering/kafka/","result":{"data":{"cur":{"id":"c8938597-f720-59b3-aeff-05495be9093f","html":"<p><img src=\"https://fs.buttercms.com/resize=width:940/308TQEVTEe468SWNPWwn\" alt=\"사진\">\n이번에 카프카를 로컬에서도 돌려보고 클라우드 환경에서도 다뤄보게 되었다. 그래서 카프카의 구조나 기본 개념에 대해 정리를 하고 가야할 필요성을 느꼈다.</p>\n<p>물론 실제 구축을 할때는 인프라적인 측면에서 더 애를 먹는다. 방화벽 설정이라던지.. 그래서 기본적인 개념에 대해서는 약간 소홀해 지는 경향이 있었다.</p>\n<p>아래 토픽 생성할 때의 shell 명령어를 보자</p>\n<div class=\"gatsby-highlight\" data-language=\"zsh\"><pre class=\"language-zsh\"><code class=\"language-zsh\">$&gt;./bin/kafka-topics.sh --create --topic fastcampus \\\n--bootstrap-server localhost:9092 --partitions 3 --replication-factor 2</code></pre></div>\n<p>사실 이 문구를 그냥 copy/paste 한다면야 생성 가능하겠지만 <code class=\"language-text\">--replication-factor 2</code>라는 명령어가 어떤 의미인지 잘 모른다면 사실상 kafka를 사용하는 의미가 없다.</p>\n<p>때문에 이번 기회에 깊이있게는 아니더라도 대략적으로 정리를 해보려고 한다.</p>\n<h1 id=\"back-ground-of-kafka\" style=\"position:relative;\"><a href=\"#back-ground-of-kafka\" aria-label=\"back ground of kafka permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Back ground of Kafka</h1>\n<h2 id=\"kafka는-왜-kafka일까\" style=\"position:relative;\"><a href=\"#kafka%EB%8A%94-%EC%99%9C-kafka%EC%9D%BC%EA%B9%8C\" aria-label=\"kafka는 왜 kafka일까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kafka는 왜 Kafka일까?</h2>\n<p>카프카의 창시자인 Jay Kreps는 <font color=\"#c00000\">kafka는 쓰기에 최적화된 시스템</font>이기에 작가의 이름을 붙이는게 낫다고 생각하여 본인이 좋아하는 작가인 프란츠 카프카의 이름을 오픈소스 프로젝트 이름으로 명명했다.</p>\n<h2 id=\"before-kafka--after-kafka\" style=\"position:relative;\"><a href=\"#before-kafka--after-kafka\" aria-label=\"before kafka  after kafka permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Before Kafka &#x26; After kafka</h2>\n<h3 id=\"before-kafka\" style=\"position:relative;\"><a href=\"#before-kafka\" aria-label=\"before kafka permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Before Kafka</h3>\n<ol>\n<li>앱이 하나의 서버 혹은 여러 서버에 직접 메트릭을 전송</li>\n</ol>\n<p><img src=\"https://genmwill.wordpress.com/wp-content/uploads/2015/09/data-flow-ugly.png\" alt=\"사진\"></p>\n<h3 id=\"after-kafka\" style=\"position:relative;\"><a href=\"#after-kafka\" aria-label=\"after kafka permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>After kafka</h3>\n<ol>\n<li>중앙집중형의 Pub/sub 메시징 시스템을 통해 여러 앱으로부터 메트릭을 수신한다.</li>\n</ol>\n<p><img src=\"https://genmwill.wordpress.com/wp-content/uploads/2015/09/stream-centric-architecture1.png\" alt=\"사진\"></p>\n<h2 id=\"kafka의-장점이자-목표\" style=\"position:relative;\"><a href=\"#kafka%EC%9D%98-%EC%9E%A5%EC%A0%90%EC%9D%B4%EC%9E%90-%EB%AA%A9%ED%91%9C\" aria-label=\"kafka의 장점이자 목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kafka의 장점이자 목표</h2>\n<blockquote>\n<p>push/pull 모델을 사용하여 <font color=\"#c00000\"><u>producer 와 consummer의 분리</u></font>\n여러 Consumer를 허용하도록 메시징 시스템 내에서 <u><font color=\"#c00000\">메시지 데이터에 대한 지속성 제공</font></u>(데이터를 소비해도 삭제되지 않음)\n<u><font color=\"#c00000\">높은 메시지 처리량</font></u>을 위한 최적화 분산 처리로 속도를 최적화 함\n시스템의<font color=\"#c00000\"> <u>수평적 확장</u></font>이 쉽다.</p>\n</blockquote>\n<h1 id=\"kafka---core\" style=\"position:relative;\"><a href=\"#kafka---core\" aria-label=\"kafka   core permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kafka - Core</h1>\n<h2 id=\"kafka의-기본-아이디어\" style=\"position:relative;\"><a href=\"#kafka%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%95%84%EC%9D%B4%EB%94%94%EC%96%B4\" aria-label=\"kafka의 기본 아이디어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kafka의 기본 아이디어</h2>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21191&#x26;authkey=%21AC2HGNuR6n4NqmI&#x26;width=1799&#x26;height=691\" alt=\"사진\"></p>\n<h4 id=\"카프카에-u데이터를-넣는u-font-colorc00000producerfont\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EC%97%90-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%84%A3%EB%8A%94u-font-colorc00000producerfont\" aria-label=\"카프카에 u데이터를 넣는u font colorc00000producerfont permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카에 <u>데이터를 넣는</u> <font color=\"#c00000\">Producer</font></h4>\n<h4 id=\"그-u데이터를-꺼내가는u-font-colorc00000consumerfont\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EA%BA%BC%EB%82%B4%EA%B0%80%EB%8A%94u-font-colorc00000consumerfont\" aria-label=\"그 u데이터를 꺼내가는u font colorc00000consumerfont permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 <u>데이터를 꺼내가는</u> <font color=\"#c00000\">consumer</font></h4>\n<h4 id=\"그-u데이터가-들어가는u-공간인-font-colorc00000topicfont\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B0%80-%EB%93%A4%EC%96%B4%EA%B0%80%EB%8A%94u-%EA%B3%B5%EA%B0%84%EC%9D%B8-font-colorc00000topicfont\" aria-label=\"그 u데이터가 들어가는u 공간인 font colorc00000topicfont permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 <u>데이터가 들어가는</u> 공간인 <font color=\"#c00000\">Topic</font></h4>\n<ul>\n<li>topic은 사실상 <u>카프카를 사용하는 이유</u>이다.</li>\n<li>카프카에서 메시지를 구분하는 단위다.(파일 시스템의 폴더와 유사)</li>\n<li>어러 토픽으로 이뤄질 수 있고 목적에 따라 이름을 붙일 수 있다. -> 폴더에 이름 붙이는거와 같음</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21200&#x26;authkey=%21ANuASgyQOYKM1og&#x26;width=1450&#x26;height=472\" alt=\"사진\"></p>\n<h2 id=\"kafka의-구성요소\" style=\"position:relative;\"><a href=\"#kafka%EC%9D%98-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C\" aria-label=\"kafka의 구성요소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kafka의 구성요소</h2>\n<h3 id=\"topic\" style=\"position:relative;\"><a href=\"#topic\" aria-label=\"topic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Topic</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21205&#x26;authkey=%21AL8SRGxSZtDDeuM&#x26;width=1192&#x26;height=428\" alt=\"사진\"></p>\n<ul>\n<li><u><font color=\"#c00000\">메시지의 구분 단위</font></u>이며 내부에서 여러 개의 파티션으로 구성된다.</li>\n<li>파티션은 병렬 처리를 위한 <font color=\"#c00000\"><u>데이터를 담는 공간</u></font>이며 파티션에 담긴 <u><font color=\"#c00000\">데이터를 레코드</font></u>라고 한다.</li>\n</ul>\n<h3 id=\"broker\" style=\"position:relative;\"><a href=\"#broker\" aria-label=\"broker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>broker</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21196&#x26;authkey=%21ALBdoeTxvLTO6S0&#x26;width=1230&#x26;height=284\" alt=\"사진\"></p>\n<ul>\n<li>카프카가 설치되어 있는 서버 -> 보통 3개 이상의 브로커로 구성한다.</li>\n</ul>\n<h3 id=\"partition\" style=\"position:relative;\"><a href=\"#partition\" aria-label=\"partition permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>partition</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21200&#x26;authkey=%21ANuASgyQOYKM1og&#x26;width=1450&#x26;height=472\" alt=\"사진\"></p>\n<ul>\n<li><strong>파티션마다</strong> 각 메시지가 0부터 1씩 증가하는 offset 값을 갖는다</li>\n<li>큐(queue)와 비슷한 구조로 FIFO처럼 먼저 들어간 레코드는 컨슈머가 먼저 가져가게 된다.\n→ <u><font color=\"#c00000\">하지만 데이터를 가져간다고 레코드가 삭제되지 않는다.</font></u></li>\n</ul>\n<blockquote>\n<p>➡️ 레코드가 삭제되는 지점은 설정가능하다.</p>\n<ul>\n<li>레코드 보존시간 -> <code class=\"language-text\">log.retension.ms</code></li>\n<li>레코드 보존크기 -> <code class=\"language-text\">log.retension.type</code></li>\n</ul>\n<p>➡️ 삭제되지 않는다의 의미</p>\n<ul>\n<li>다른 Consumer가 다시 0qjs offset부터 가져갈 수 있다는 것을 의미한다.</li>\n</ul>\n</blockquote>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21195&#x26;authkey=%21ACDfXcKNr5aL7qA&#x26;width=1264&#x26;height=519\" alt=\"사진\"></p>\n<ul>\n<li>카프카 병렬처리의 핵심</li>\n<li>Topic 생성 시 partition 개수를 지정 가능하며 이를 늘릴 수는 있으나, 줄일 수는 없다.</li>\n<li>레코드가 어느 파티션으로 갈지 결정하는 방법\n<ul>\n<li>key 값이 존재하지 않는 경우 → Round-robin 방식으로 고르게 분배</li>\n<li>key 값이 존재하는 경우 → key를 hash 함수에 넣어서 파티션 결정</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"isrin-sync-replica\" style=\"position:relative;\"><a href=\"#isrin-sync-replica\" aria-label=\"isrin sync replica permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ISR(In Sync Replica)</h3>\n<p>파티션 복제는 곧 -> 고가용성을 의미한다.</p>\n<ul>\n<li>원본이 Leader, 복사본이 Follower -> 리더에 장애 날 경우 follower가 leader로 승격한다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21199&#x26;authkey=%21APFnyOcvfXPurao&#x26;width=1167&#x26;height=385\" alt=\"사진\"></p>\n<h3 id=\"producer\" style=\"position:relative;\"><a href=\"#producer\" aria-label=\"producer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>producer</h3>\n<ul>\n<li>토픽에 해당하는 메시지 생성, 특정 토픽으로 데이터를 Publish</li>\n</ul>\n<h4 id=\"producer의-내부-구조\" style=\"position:relative;\"><a href=\"#producer%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\" aria-label=\"producer의 내부 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>producer의 내부 구조</h4>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21204&#x26;authkey=%21AJtaBMq0c8chJjo&#x26;width=720&#x26;height=319\" alt=\"사진\"></p>\n<ul>\n<li><strong>ProducerRecord</strong> : 프로듀서에서 생성하는 레코드</li>\n<li><strong>send()</strong> : 레코드 전송 요청 메소드</li>\n<li><strong>Partitioner</strong> : 어느 파티션으로 전송할 지 지정</li>\n<li><strong>Accumulator</strong> : 배치로 묶어 전송할 데이터를 모으는 버퍼</li>\n<li><strong>Sender</strong> : Accumulator의 메시지를 Fetch하여 브로커로 전송</li>\n</ul>\n<h4 id=\"ack-설정에-따른-가용성과-속도의-trade-off\" style=\"position:relative;\"><a href=\"#ack-%EC%84%A4%EC%A0%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EA%B0%80%EC%9A%A9%EC%84%B1%EA%B3%BC-%EC%86%8D%EB%8F%84%EC%9D%98-trade-off\" aria-label=\"ack 설정에 따른 가용성과 속도의 trade off permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ACK 설정에 따른 가용성과 속도의 Trade off</h4>\n<p>보통 요구 사항에 따라 결정한다.</p>\n<h5 id=\"font-colorc00000ack--0font\" style=\"position:relative;\"><a href=\"#font-colorc00000ack--0font\" aria-label=\"font colorc00000ack  0font permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><font color=\"#c00000\"><strong>ACK = 0</strong></font></h5>\n<ul>\n<li>리더에게 전송하고 <u><font color=\"#c00000\">응답값을 받지 않는다.</font></u></li>\n<li>리더에 잘 갔는지도, 복제되었는지도 알 수 없다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21194&#x26;authkey=%21AMZSSrIZN5UirAY&#x26;width=1184&#x26;height=362\" alt=\"사진\"></p>\n<h5 id=\"font-colorc00000ack--1font\" style=\"position:relative;\"><a href=\"#font-colorc00000ack--1font\" aria-label=\"font colorc00000ack  1font permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><font color=\"#c00000\"><strong>ACK = 1</strong></font></h5>\n<ul>\n<li>리더에게 전송하고, <u><font color=\"#c00000\">리더에게만 응답값을 받는다.</font></u></li>\n<li>리더에게는 잘 갔는지 알 수 있지만, 잘 복제되었는지는 알 수 없다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21192&#x26;authkey=%21AKxo8F3KmEECInw&#x26;width=1171&#x26;height=345\" alt=\"사진\"></p>\n<h5 id=\"font-colorc00000ack--allfont\" style=\"position:relative;\"><a href=\"#font-colorc00000ack--allfont\" aria-label=\"font colorc00000ack  allfont permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><font color=\"#c00000\"><strong>ACK = all</strong></font></h5>\n<ul>\n<li>리더에게 전송하고, 리더와 팔로워 <u><font color=\"#c00000\">모두에게 응답값을 받는다.</font></u></li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21193&#x26;authkey=%21AIPcapuAQe40qDI&#x26;width=1163&#x26;height=364\" alt=\"사진\"></p>\n<h3 id=\"consumer\" style=\"position:relative;\"><a href=\"#consumer\" aria-label=\"consumer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consumer</h3>\n<ul>\n<li>토픽의 파티션으로부터 데이터 polling</li>\n</ul>\n<h4 id=\"consumer의-내부-구조\" style=\"position:relative;\"><a href=\"#consumer%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\" aria-label=\"consumer의 내부 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consumer의 내부 구조</h4>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21198&#x26;authkey=%21AF1Gh5erXuILV_s&#x26;width=720&#x26;height=284\" alt=\"사진\"></p>\n<ul>\n<li><strong>Fetcher</strong> : 리더 파티션으로부터 레코드들을 가져와서 대기</li>\n<li><strong>poll()</strong> : Fetcher에 있는 레코드를 리턴</li>\n<li><strong>ConsumerRecord</strong> : 처리하고자 하는 레코드 모임</li>\n</ul>\n<h4 id=\"파티션-offset-위치-기록\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%ED%8B%B0%EC%85%98-offset-%EC%9C%84%EC%B9%98-%EA%B8%B0%EB%A1%9D\" aria-label=\"파티션 offset 위치 기록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파티션 offset 위치 기록</h4>\n<ul>\n<li>파티션에 들어간 데이터는 <font color=\"#c00000\"><u>파티션 내에서 고유한 번호(offset)를 갔는다</u></font></li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21202&#x26;authkey=%21AO9KwJqCCmTw_Ok&#x26;width=1129&#x26;height=269\" alt=\"사진\"></p>\n<ul>\n<li>consumer가 어느 지점까지 읽었는지 확인하기위한 용도이다.\n<ul>\n<li>장애로 인해 재실행 되었을때 중단시점을 알기에 <font color=\"#c00000\"><u>데이터 중복 및 손실이 일어나는 것을 방지</u></font>한다.</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21203&#x26;authkey=%21AMAdXiS0iJTbALA&#x26;width=720&#x26;height=205\" alt=\"사진\"></p>\n<h4 id=\"consumer-group\" style=\"position:relative;\"><a href=\"#consumer-group\" aria-label=\"consumer group permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consumer group</h4>\n<ul>\n<li>여러 파티션을 가진 토픽에 대해서 consumer를 병렬 처리할 때 사용한다.</li>\n<li>서로 다른 그룹에 속하면 영향을 미치지 않으므로 동일한 파티션 접근이 가능하다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21197&#x26;authkey=%21AAYbCKdPKW-lGnM&#x26;width=1150&#x26;height=412\" alt=\"사진\"></p>\n<h4 id=\"lag-metric\" style=\"position:relative;\"><a href=\"#lag-metric\" aria-label=\"lag metric permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lag metric</h4>\n<ul>\n<li><font color=\"#c00000\"> 컨슈머가 마지막으로 읽은 offset과 프로듀서가 마지막으로 넣은 offset의 차이</font></li>\n<li>파티션 마다 lag 값을 특정할 수 있다.</li>\n<li>lag의 차이가 크게 되면 실시간이 실시간이 아니게 되어 버리거나 할 수 있으므로 성능이 나오지 않거나, 비정상 동작을 할 때 모니터링할 수 있다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21201&#x26;authkey=%21AAkRS3QCoBy9wz8&#x26;width=434&#x26;height=705\" alt=\"사진\"></p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>이렇게 kafka의 기본 개념과 구성요소에 대해서 간단하게나마 정리를 해보았다. 사실 kafka를 잘 아시는 분이라면 ‘하나 빠졌는데!!!!’하실 수 있을 것 같다.</p>\n<p>바로 metadata 보관 장소이자 브로커가 사춘기 왔을때 잡아주는 엄마같은 존재인 zookeeper다.</p>\n<p>사실 zookeeper를 다루지 않은 이유는 kafka 3.x.x버전에서는 zookeeper를 더 이상 사용하지 않고 <font color=\"#c00000\">KRaft</font>를 사용한다. zookeeper는 kafka와 완전 별개의 애플리케이션이기에 사실상 계모같은 존재였다. 때문에 안전성이나 확장성 측면에서 불안하여 3.x.x버전 부터는 KRaft라는 kafka 단일 애플리케이션 즉, 진짜 엄마를 찾아서 사용한다.</p>\n<p>그래서 나중에 둘의 차이에 대해서 다로 포스팅하고자 이번 포스팅에서는 제외하기로 하였다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#kafka%EB%8A%94-%EC%99%9C-kafka%EC%9D%BC%EA%B9%8C\">Kafka는 왜 Kafka일까?</a></p>\n</li>\n<li>\n<p><a href=\"#before-kafka--after-kafka\">Before Kafka &#x26; After kafka</a></p>\n<ul>\n<li><a href=\"#before-kafka\">Before Kafka</a></li>\n<li><a href=\"#after-kafka\">After kafka</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#kafka%EC%9D%98-%EC%9E%A5%EC%A0%90%EC%9D%B4%EC%9E%90-%EB%AA%A9%ED%91%9C\">kafka의 장점이자 목표</a></p>\n</li>\n<li>\n<p><a href=\"#kafka%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%95%84%EC%9D%B4%EB%94%94%EC%96%B4\">kafka의 기본 아이디어</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EC%97%90-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%84%A3%EB%8A%94u-font-colorc00000producerfont\">카프카에 <u>데이터를 넣는</u> <font color=\"#c00000\">Producer</font></a></li>\n<li><a href=\"#%EA%B7%B8-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EA%BA%BC%EB%82%B4%EA%B0%80%EB%8A%94u-font-colorc00000consumerfont\">그 <u>데이터를 꺼내가는</u> <font color=\"#c00000\">consumer</font></a></li>\n<li><a href=\"#%EA%B7%B8-u%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B0%80-%EB%93%A4%EC%96%B4%EA%B0%80%EB%8A%94u-%EA%B3%B5%EA%B0%84%EC%9D%B8-font-colorc00000topicfont\">그 <u>데이터가 들어가는</u> 공간인 <font color=\"#c00000\">Topic</font></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#kafka%EC%9D%98-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C\">kafka의 구성요소</a></p>\n<ul>\n<li>\n<p><a href=\"#topic\">Topic</a></p>\n</li>\n<li>\n<p><a href=\"#broker\">broker</a></p>\n</li>\n<li>\n<p><a href=\"#partition\">partition</a></p>\n</li>\n<li>\n<p><a href=\"#isrin-sync-replica\">ISR(In Sync Replica)</a></p>\n</li>\n<li>\n<p><a href=\"#producer\">producer</a></p>\n<ul>\n<li>\n<p><a href=\"#producer%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\">producer의 내부 구조</a></p>\n</li>\n<li>\n<p><a href=\"#ack-%EC%84%A4%EC%A0%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EA%B0%80%EC%9A%A9%EC%84%B1%EA%B3%BC-%EC%86%8D%EB%8F%84%EC%9D%98-trade-off\">ACK 설정에 따른 가용성과 속도의 Trade off</a></p>\n<ul>\n<li><a href=\"#font-colorc00000ack--0font\"><font color=\"#c00000\"><strong>ACK = 0</strong></font></a></li>\n<li><a href=\"#font-colorc00000ack--1font\"><font color=\"#c00000\"><strong>ACK = 1</strong></font></a></li>\n<li><a href=\"#font-colorc00000ack--allfont\"><font color=\"#c00000\"><strong>ACK = all</strong></font></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#consumer\">Consumer</a></p>\n<ul>\n<li><a href=\"#consumer%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\">Consumer의 내부 구조</a></li>\n<li><a href=\"#%ED%8C%8C%ED%8B%B0%EC%85%98-offset-%EC%9C%84%EC%B9%98-%EA%B8%B0%EB%A1%9D\">파티션 offset 위치 기록</a></li>\n<li><a href=\"#consumer-group\">Consumer group</a></li>\n<li><a href=\"#lag-metric\">Lag metric</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"사진\n이번에 카프카를 로컬에서도 돌려보고 클라우드 환경에서도 다뤄보게 되었다. 그래서 카프카의 구조나 기본 개념에 대해 정리를 하고 가야할 필요성을 느꼈다. 물론 실제 구축을 할때는 인프라적인 측면에서 더 애를 먹는다. 방화벽 설정이라던지.. 그래서 기본적인 개념에 대해서는 약간 소홀해 지는 경향이 있었다. 아래 토픽 생성할 때의 shell 명령어를 보자 사실 이 문구를 그냥 copy/paste 한다면야 생성 가능하겠지만 라는 명령어가 어떤 의미인지 잘 모른다면 사실상 kafka를 사용하는 의미가 없다. 때문에 이번 기회에 깊이있게는 아니더라도 대략적으로 정리를 해보려고 한다. Back ground of Kafka Kafka는 왜 Kafka일까? 카프카의 창시자인 Jay Kreps는 kafka는 쓰기에 최적화된 시스템이기에 작가의 이름을 붙이는게 낫다고 생각하여 본인이 좋아하는 작가인 프란츠 카프카의 이름을 오픈소스 프로젝트 이름으로 명명했다. Before Kafka & After…","frontmatter":{"date":"April 19, 2024","title":"Apache Kafka에 대해 전반적으로 알아보자","categories":"Data_Engineering","author":"최지혁","emoji":"💫"},"fields":{"slug":"/Data Engineering/kafka/"}},"next":{"id":"a072a1f4-cdc0-5328-a338-4ba99b967d9e","html":"<h1 id=\"aws---jammy-inrelease--101-network-is-unreachable\" style=\"position:relative;\"><a href=\"#aws---jammy-inrelease--101-network-is-unreachable\" aria-label=\"aws   jammy inrelease  101 network is unreachable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS - jammy InRelease &#x26; 101: Network is unreachable</h1>\n<h2 id=\"jammy-inrelease-오류\" style=\"position:relative;\"><a href=\"#jammy-inrelease-%EC%98%A4%EB%A5%98\" aria-label=\"jammy inrelease 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jammy InRelease 오류</h2>\n<p>카프카 브로커 Ubuntu 서버에 java를 설치하려고 하는데 아래와 같은 문구가 뜨면서 동작이 되지 않았다. 무슨 jammy가 inrelease된 것 같은데 재미 하나도 없고 머리 아프다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ign: 1 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy InRelease\nIgn: 2 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease \nIgn: 3 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy-backports\nCannot initiate the connection to ap-northeast-2.ec2.archive.ubuntu.com:80 (2406:da12:944:ae00:128:62c8:e? ). - connect (101: Network is unreachable)</code></pre></div>\n<p>다행히도 해당 에러에 대해서는 AWS측에서 답변 달아준 부분 있다.\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21190&#x26;authkey=%21ADpusYyw3sAPnzs&#x26;width=1232&#x26;height=1038\" alt=\"\"></p>\n<h3 id=\"공식-해결-방법\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EC%8B%9D-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"공식 해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공식 해결 방법</h3>\n<p>대충 해석을 보면 아래의 포인트들을 다시 체크해봐라 같은데 해석해보면 다음과 같다.</p>\n<ul>\n<li>현재 EC2가 제대로 작동하는 다른 EC2들과 <font color=\"#c00000\">동일한 VPC 및 서브넷에 배포되었는가</font>?</li>\n<li>그게 아니라면 VPC가 <font color=\"#c00000\">인터넷 게이트웨이로 인터넷에 접근이 허용</font>되어 있는가?</li>\n<li>서브넷이 public이라면 인터넷 바운드 트레픽을 <font color=\"#c00000\">인터넷 게이트 웨이로 라우팅</font><font color=\"#c00000\">하는</font> <font color=\"#c00000\">라우팅 테이블이 있는가</font>?</li>\n<li>서브넷이 private이라면 인터넷 바운드 트래픽을 공용 서브넷의 <font color=\"#c00000\">NAT 게이트 위에이로 라우팅하는 라우팅 테이블이 있는가</font>?</li>\n</ul>\n<h3 id=\"체크리스트\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8\" aria-label=\"체크리스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크리스트</h3>\n<p>첫째로, EC2는 <font color=\"#245bdb\">동일한 VPC에 배포</font>되었으며 각각의 브로커 서브넷은 private로 두기 위해 종류를 다르게 하였다.\n<br/></p>\n<p>둘째로, 나는 비용절감을 위해<font color=\"#245bdb\"> NAT Instance를 구축</font>했고 public NAT 서버는 라우팅 테이블이 잘 설정되어 있으며 <font color=\"#245bdb\">라우팅 테이블은 3개의 브로커 서브넷을 잘 가리키고 있었다.</font>\n<br/></p>\n<p>셋째로, 브로커 private 서브넷의 <font color=\"#245bdb\">바운드 규칙 또한 public NAT에 잘 뚫어준 것도  확인</font>했다.</p>\n<p>따라서 해당사항은 없다고 생각했다. 때문에 같이 나온 에러인 <font color=\"#c00000\">80번 포트 접속에 대한 101 에러에 대해서 탐색</font>해보기로 했다.</p>\n<h2 id=\"101-network-is-unreachable-오류\" style=\"position:relative;\"><a href=\"#101-network-is-unreachable-%EC%98%A4%EB%A5%98\" aria-label=\"101 network is unreachable 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>101: Network is unreachable 오류</h2>\n<p>해당 사항에 대해서는 구글링 및 AWS 답변을 찾아본 결과 80번 포트가 막혀있어서 그렇단다. 때문에 public nat의 인바운드와 아웃바운드 규칙을 잠시 모든 TCP에 대하여 허용해주었다.\n하지만 여전히 같은 에러가 났다…</p>\n<h1 id=\"오류-해결-방법\" style=\"position:relative;\"><a href=\"#%EC%98%A4%EB%A5%98-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"오류 해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오류 해결 방법</h1>\n<h2 id=\"iptable-설정하기\" style=\"position:relative;\"><a href=\"#iptable-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"iptable 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IPtable 설정하기</h2>\n<p>이렇게 허무할 수가, 알고보니 iptable 설정이 잘 못 되어 있었다… 인프라 설정 덕분에 3시간이 날아가 버렸다..</p>\n<blockquote>\n<p>iptable이란?\n리눅스에 저장된 네트워크 패킷 필터링 시스템으로 네트워크 트래픽을 관리하여 패킷을 허용하거나 차단할 수 있다.</p>\n</blockquote>\n<p>아래처럼 iptable을 설치해주면 이제 인터넷 연결이 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> iptables-services <span class=\"token parameter variable\">-y</span>\n$ <span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> iptables\n$ <span class=\"token function\">sudo</span> systemctl start iptables\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">vi</span> /etc/sysctl.d/custom-ip-forwarding.conf\n<span class=\"token assign-left variable\">net.ipv4.ip_forward</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">-p</span> /etc/sysctl.d/custom-ip-forwarding.conf\n$ <span class=\"token function\">sudo</span> /sbin/iptables <span class=\"token parameter variable\">-t</span> nat <span class=\"token parameter variable\">-A</span> POSTROUTING <span class=\"token parameter variable\">-o</span> enXO <span class=\"token parameter variable\">-j</span> MASQUERADE\n$ <span class=\"token function\">sudo</span> /sbin/iptables <span class=\"token parameter variable\">-F</span> FORWARD\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> iptables</code></pre></div>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>AWS는 삽질을 통한 깨달음을 얻어야 한다!! 해결됐을때 그 시원함도 너무 좋다.</p>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reference</h2>\n<p>[AWS 답변]\n<a href=\"https://repost.aws/ko/questions/QUTEPp5mJMTqyJfpuA3JCkrA/new-ubuntu-ec2-instance-do-not-work-in-eu-north-1?sc_ichannel=ha&#x26;sc_ilang=en&#x26;sc_isite=repost&#x26;sc_iplace=hp&#x26;sc_icontent=QUTEPp5mJMTqyJfpuA3JCkrA&#x26;sc_ipos=16\">https://repost.aws/ko/questions/QUTEPp5mJMTqyJfpuA3JCkrA/new-ubuntu-ec2-instance-do-not-work-in-eu-north-1?sc_ichannel=ha&#x26;sc_ilang=en&#x26;sc_isite=repost&#x26;sc_iplace=hp&#x26;sc_icontent=QUTEPp5mJMTqyJfpuA3JCkrA&#x26;sc_ipos=16</a></p>\n<p><a href=\"https://repost.aws/ko/questions/QURAplea7CQY2d_4BOXR4HLQ/unable-to-connect-101-network-is-unreachable\">https://repost.aws/ko/questions/QURAplea7CQY2d_4BOXR4HLQ/unable-to-connect-101-network-is-unreachable</a></p>\n<p>[Iptable]\n<a href=\"https://hobbylists.tistory.com/entry/Iptables-%EA%B8%B0%EC%B4%88-%EC%82%AC%EC%9A%A9%EB%B2%95%EA%B3%BC-%EC%98%B5%EC%85%98-%EC%A0%95%EB%A6%AC-1-%EB%B0%A9%ED%99%94%EB%B2%BD-Netfilter-%EB%A6%AC%EB%88%85%EC%8A%A4\">https://hobbylists.tistory.com/entry/Iptables-기초-사용법과-옵션-정리-1-방화벽-Netfilter-리눅스</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#jammy-inrelease-%EC%98%A4%EB%A5%98\">jammy InRelease 오류</a></p>\n<ul>\n<li><a href=\"#%EA%B3%B5%EC%8B%9D-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">공식 해결 방법</a></li>\n<li><a href=\"#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8\">체크리스트</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#101-network-is-unreachable-%EC%98%A4%EB%A5%98\">101: Network is unreachable 오류</a></p>\n</li>\n<li>\n<p><a href=\"#iptable-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">IPtable 설정하기</a></p>\n</li>\n<li>\n<p><a href=\"#reference\">reference</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"April 16, 2024","title":"AWS - jammy InRelease & 101 Network is unreachable 해결하기","categories":"ERROR Cloud","author":"최지혁","emoji":"🧰"},"fields":{"slug":"/error/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://statisticsfox.github.io","comments":{"utterances":{"repo":"StatisticsFox/blog-comments"}}}}},"pageContext":{"slug":"/Data Engineering/kafka/","nextSlug":"/error/","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}