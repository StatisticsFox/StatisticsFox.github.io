{"componentChunkName":"component---src-templates-blog-template-js","path":"/Data Engineering/","result":{"data":{"cur":{"id":"10c10b8e-1dd3-52c2-aad6-143b3a048b6c","html":"<h2 id=\"데이터-파이프라인-최적화의-필요성\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8-%EC%B5%9C%EC%A0%81%ED%99%94%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1\" aria-label=\"데이터 파이프라인 최적화의 필요성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 파이프라인 최적화의 필요성</h2>\n<p>대 빅데이터 시대인 만큼 <strong>데이터 파이프라인을 최적화하는 것</strong>은 굉장히 중요하다. 특히 <strong>MLOps 분야</strong>에서는 훨씬 더 중요하다. 왜냐하면 AI 성능이 기하급수적으로 발전하면서 그만큼 추론속도나 학습 속도 또한 굉장히 중요해지고 있기 때문이다.\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21172&#x26;authkey=%21AMLVmAUUwVh49k4&#x26;width=1568&#x26;height=468\" alt=\"사진\"></p>\n<h2 id=\"보편적인-최적화-방안이-존재할까\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%8E%B8%EC%A0%81%EC%9D%B8-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%B0%A9%EC%95%88%EC%9D%B4-%EC%A1%B4%EC%9E%AC%ED%95%A0%EA%B9%8C\" aria-label=\"보편적인 최적화 방안이 존재할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보편적인 최적화 방안이 존재할까?</h2>\n<p>그렇다면 데이터 파이프라인을 최적화하는 보편적인 정답이 존재할까? 내 대답은 <strong>No</strong>!다. 구축하는 파이프라인마다 도메인과 요구사항들이 모두 다르기 때문에 보편적인 요구사항이란 존재할 수 없다.\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21164&#x26;authkey=%21AN1DKoWFA8cD0Yg&#x26;width=1246&#x26;height=424\" alt=\"사진\"></p>\n<h2 id=\"보편적인-컴포넌트는-존재할까\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%8E%B8%EC%A0%81%EC%9D%B8-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%8A%94-%EC%A1%B4%EC%9E%AC%ED%95%A0%EA%B9%8C\" aria-label=\"보편적인 컴포넌트는 존재할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보편적인 컴포넌트는 존재할까?</h2>\n<p>그렇다면 보편적인 컴포넌트는 중요할까? 내 대답은 <strong>Yes</strong>다. 보편적인 컴포넌트는 존재한다. 바로 <strong>DataLake</strong>다.\n데이터 파이프라인은 “수집 -> 적재 -> 처리 -> 활용”의 단계를 거치는데 이때 적재 부분에서 실제 데이터를 운영용으로쓰는 경우에는 Datalake를 사용할 수밖에 없다. 따라서 <strong>datalake를 최적화 하는것이 결국 데이터 파이프라인을 최적화 하는것과 다름없다고 생각한다.</strong>\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21166&#x26;authkey=%21AIeFHkvVBN7IT1w&#x26;width=1024&#x26;height=270\" alt=\"사진\"></p>\n<h2 id=\"datalake를-최적화-해보자\" style=\"position:relative;\"><a href=\"#datalake%EB%A5%BC-%EC%B5%9C%EC%A0%81%ED%99%94-%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"datalake를 최적화 해보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DataLake를 최적화 해보자</h2>\n<blockquote>\n<p>Data Lake를 최적화하다니? DataLake는 이미 나와 있는 제품 아닌가?</p>\n</blockquote>\n<p>라고할 수 도 있다. 어느정도는 맞는 말이며 마찬가지로 제품 또한 요구사항에 따라 바뀐다. 비용 최적화에 대한 니즈가 높은 경우 데이터 중요도 마다 클래스를 다르게 하여 비용을 더 저렴하게 지불 가능한 S3를 이용할 수 있고, 사용하는 툴에 따라서 호환성에 맞는 gcp나 azure또한 선택 가능하다. 따라서 이번에 할얘기는 Data Format에 관한 이야기다.</p>\n<h2 id=\"csv-vs-parquet\" style=\"position:relative;\"><a href=\"#csv-vs-parquet\" aria-label=\"csv vs parquet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSV vs Parquet</h2>\n<p>오늘은 두가지 데이터 포맷을 비교해 볼 것이다. 바로 <strong>parquet</strong>과 <strong>csv</strong> 파일을 비교해 보고자 한다. 나는 통계학과에 재학 당시(사실 지금도 재학 중..) 대부분의 데이터를 이용할때 CSV 형태의 파일을 이용하였다. 왜냐하면 공공데이터나 데이콘 혹은 인터넷에서 주로 배포된 데이터의 경우 대부분 CSV 파일로 배포가 되었기 때문이다. 지금에서야 이유를 생각해보면 CSV가 아무래도 <strong>마이크로소프트 엑셀로 쉽게 확인이 가능하고 훨씬 친숙</strong>하기 때문에 대부분 csv 파일로 데이터를 배포하는 것 같다.\n<img src=\"./https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21167&#x26;authkey=%21AGSuC2Ee7BHt-n0&#x26;width=1202&#x26;height=380\" alt=\"사진\">\n때문에 나도 parquet 보다는 csv를 주로 이용해봤다. 다만 나는 어떤 실험을 통해 더이상 csv 파일은 왠만해서는 사용하지 않는데 오늘은 이 실험에 대해 소개해 보고자 한다.</p>\n<h2 id=\"csv와-parquet-비교실험\" style=\"position:relative;\"><a href=\"#csv%EC%99%80-parquet-%EB%B9%84%EA%B5%90%EC%8B%A4%ED%97%98\" aria-label=\"csv와 parquet 비교실험 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>csv와 parquet 비교실험</h2>\n<p>먼저 실험 환경은 다음과 같다.</p>\n<ul>\n<li>컴퓨터: Mac m1 Pro</li>\n<li>메모리: Ram 16GB</li>\n<li>대역폭: 100GB/s</li>\n<li>용량: SSD 1TB</li>\n<li>Processor: 8 core CPU</li>\n<li>Remote Storage: AWS S3</li>\n</ul>\n<p>실험 아키텍처는 다음과 같다.</p>\n<p>데이터는 케글의 아마존 <a href=\"https://www.kaggle.com/datasets/muhammedabdulazeem/amazon-electronics-items-reviews\">전자제품 리뷰 데이터</a>를 사용하였다.\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21163&#x26;authkey=%21ACPWuFhmA36B8YA&#x26;width=1192&#x26;height=778\" alt=\"사진\"></p>\n<h3 id=\"size\" style=\"position:relative;\"><a href=\"#size\" aria-label=\"size permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Size</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21174&#x26;authkey=%21AJPPIE-TwZV8B9w&#x26;width=1084&#x26;height=536\" alt=\"사진\">\nparquet 파일이 1.84% 더 작은 것을 확인 가능하다.</p>\n<h3 id=\"download-speed\" style=\"position:relative;\"><a href=\"#download-speed\" aria-label=\"download speed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>download speed</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21168&#x26;authkey=%21AKVclBQI-Im_ZGw&#x26;width=1018&#x26;height=562\" alt=\"사진\">\nparquet 파일이 1.9% 더 빠른 것을 확인할 수 있다.</p>\n<h3 id=\"read-speed\" style=\"position:relative;\"><a href=\"#read-speed\" aria-label=\"read speed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>read speed</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21171&#x26;authkey=%21AB_V5Mbw64lg4dY&#x26;width=1200&#x26;height=368\" alt=\"사진\">\nparquet 파일이 1.78% 더 빠른 것을 확인할 수 있다.</p>\n<h3 id=\"count-speed\" style=\"position:relative;\"><a href=\"#count-speed\" aria-label=\"count speed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>count speed</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21165&#x26;authkey=%21AFupwqOeIrUMUbE&#x26;width=1120&#x26;height=344\" alt=\"사진\">\nparquet 파일이 5.9% 더 빠른 것을 확인할 수 있다.</p>\n<h3 id=\"실험결과\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%97%98%EA%B2%B0%EA%B3%BC\" aria-label=\"실험결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실험결과</h3>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21173&#x26;authkey=%21ABA9dtYq23ToNYo&#x26;width=1740&#x26;height=368\" alt=\"사진\">\n위와 같이 모든 지표가 parquet 파일이 더 좋다고 말해주고 있다. 즉, datalake 관점에서는 csv보다는 parquet파일을 적재하는 것이 훨씬 바람직하다.</p>\n<h2 id=\"parquet-파일이-더-좋은-이유\" style=\"position:relative;\"><a href=\"#parquet-%ED%8C%8C%EC%9D%BC%EC%9D%B4-%EB%8D%94-%EC%A2%8B%EC%9D%80-%EC%9D%B4%EC%9C%A0\" aria-label=\"parquet 파일이 더 좋은 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>parquet 파일이 더 좋은 이유</h2>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21169&#x26;authkey=%21ANjgskNzhHvUJAw&#x26;width=1248&#x26;height=634\" alt=\"사진\">\nparquet 파일은 열 기반과 행기반 스토리지의 장점을 모두 챙긴 hybrid기반의 데이터 포맷이다. 때문에 데이터를 읽어들이거나 인덱싱 할때 단순 행 기반 데이터 포멧인 csv가 가진 단점들을 해결해준다.</p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21170&#x26;authkey=%21AGrwU-T4bZbWuRU&#x26;width=1394&#x26;height=472\" alt=\"사진\">\n따라서 나는 사이드 프로덱트나 과제시 클라우드에 데이터를 담을 일이 있으면 주로 parquet 데이터를 이용하는 편이다. 물론 <strong>성능에 대한 니즈가 없다거나 담당자가 자주 바뀌어 범용성이 높아야하는 경우에는 csv 파일을 사용</strong>해도 문제가 없지만 그래도 클라우드를 사용하는 입장에서는 <strong>parquet 포멧으로 데이터를 적재하는 것이 바람직하다</strong>고 생각한다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8-%EC%B5%9C%EC%A0%81%ED%99%94%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1\">데이터 파이프라인 최적화의 필요성</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B3%B4%ED%8E%B8%EC%A0%81%EC%9D%B8-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%B0%A9%EC%95%88%EC%9D%B4-%EC%A1%B4%EC%9E%AC%ED%95%A0%EA%B9%8C\">보편적인 최적화 방안이 존재할까?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B3%B4%ED%8E%B8%EC%A0%81%EC%9D%B8-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%8A%94-%EC%A1%B4%EC%9E%AC%ED%95%A0%EA%B9%8C\">보편적인 컴포넌트는 존재할까?</a></p>\n</li>\n<li>\n<p><a href=\"#datalake%EB%A5%BC-%EC%B5%9C%EC%A0%81%ED%99%94-%ED%95%B4%EB%B3%B4%EC%9E%90\">DataLake를 최적화 해보자</a></p>\n</li>\n<li>\n<p><a href=\"#csv-vs-parquet\">CSV vs Parquet</a></p>\n</li>\n<li>\n<p><a href=\"#csv%EC%99%80-parquet-%EB%B9%84%EA%B5%90%EC%8B%A4%ED%97%98\">csv와 parquet 비교실험</a></p>\n<ul>\n<li><a href=\"#size\">Size</a></li>\n<li><a href=\"#download-speed\">download speed</a></li>\n<li><a href=\"#read-speed\">read speed</a></li>\n<li><a href=\"#count-speed\">count speed</a></li>\n<li><a href=\"#%EC%8B%A4%ED%97%98%EA%B2%B0%EA%B3%BC\">실험결과</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#parquet-%ED%8C%8C%EC%9D%BC%EC%9D%B4-%EB%8D%94-%EC%A2%8B%EC%9D%80-%EC%9D%B4%EC%9C%A0\">parquet 파일이 더 좋은 이유</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n</li>\n</ul>\n</div>","excerpt":"데이터 파이프라인 최적화의 필요성 대 빅데이터 시대인 만큼 데이터 파이프라인을 최적화하는 것은 굉장히 중요하다. 특히 MLOps 분야에서는 훨씬 더 중요하다. 왜냐하면 AI 성능이 기하급수적으로 발전하면서 그만큼 추론속도나 학습 속도 또한 굉장히 중요해지고 있기 때문이다.\n사진 보편적인 최적화 방안이 존재할까? 그렇다면 데이터 파이프라인을 최적화하는 보편적인 정답이 존재할까? 내 대답은 No!다. 구축하는 파이프라인마다 도메인과 요구사항들이 모두 다르기 때문에 보편적인 요구사항이란 존재할 수 없다.\n사진 보편적인 컴포넌트는 존재할까? 그렇다면 보편적인 컴포넌트는 중요할까? 내 대답은 Yes다. 보편적인 컴포넌트는 존재한다. 바로 DataLake다.\n데이터 파이프라인은 “수집 -> 적재 -> 처리 -> 활용”의 단계를 거치는데 이때 적재 부분에서 실제 데이터를 운영용으로쓰는 경우에는 Datalake를 사용할 수밖에 없다. 따라서 datalake를 최적화 하는것이 결국 데이터 파이프라…","frontmatter":{"date":"March 17, 2024","title":"DataOptimizations - Speed up your pipeline","categories":"Data_Engineering","author":"최지혁","emoji":"🛠️"},"fields":{"slug":"/Data Engineering/"}},"next":{"id":"b69e39d6-05a6-5594-938f-c93a25fe0343","html":"<p>제목을 보면 이게 무슨 소리인가 싶을 수 있다. 나도 처음 듣고 띠요옹? 했었다.</p>\n<p>내가 알고 있는 MongoDB는 BASE(BA: <strong>B</strong>asically <strong>A</strong>valiable) 즉, 가용성과 성능을 중시한 분산 시스템의 특성을 가지고 있고 또한 이 점이 기존에 ACID 특성을 가진 RDBMS와의 차이점이라고 알고 있었다.</p>\n<p>더군다나 Mongo DB가 탄생하게 된 배경이 아래와 같은 고민 끝에 탄생한 것을 알았기에 더욱 의아했었다.</p>\n<blockquote>\n<p>대규모 데이터를 처리해야 하는데 RDBMS는 성장 한계가 있구나 <strong>일관성과 무결성을 버리고</strong><br>\n더 빠른 읽기 성능과 수평확장이 가능한 DB가 필요해!</p>\n</blockquote>\n<p>그럼 어쩌다 제목과 같이 눈이 크게 떠지는 질문을 스스로에서 던졌을까</p>\n<p>이번에 대규모 시스템 설계 기초 도서를 공부하면서 CAP이론이라는 것을 처음 접하며 이 의문이 시작되었다.</p>\n<h2 id=\"cap이론-이란\" style=\"position:relative;\"><a href=\"#cap%EC%9D%B4%EB%A1%A0-%EC%9D%B4%EB%9E%80\" aria-label=\"cap이론 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CAP이론 이란?</h2>\n<p>CAP 이론은 2000년에 에릭 브류어가 최초로 소개한 이론이며 어떤 분산 시스템이더라도 <strong>Consistency</strong> (일관성), <strong>Availability</strong> (가용성), <strong>Partition tolerance</strong> (분할 내성)를 <strong>모두 만족할 수 없다는 이론</strong>이다. 이 세 가지의 머리글자를 따서 CAP 이론이라고 부른다.</p>\n<ul>\n<li><strong>consistency</strong>: 분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했느냐에 관계없이 언제나 같은 데이터를 보관해야 한다.</li>\n<li><strong>availability</strong>: 분산 시스템에 접속하는 클라이언트는 일부 노드에서 장애가 발생하더라도 항상 응답을 받을 수 있어야 한다.</li>\n<li><strong>partition</strong> <strong>tolerance</strong>: 파티션은 두 노드 사이에 통신 장애가 발생하였음을 의미한다. 파티션 감내는 네트워크에 파티션이 생기더라도 시스템은 계속해서 동작하여야 한다는 것을 의미한다.</li>\n</ul>\n<p><img src=\"https://velog.velcdn.com/images/ragi/post/b733e648-935c-41d5-8ca7-818da0c7be4f/image.png\" alt=\"CAP이론\"></p>\n<p>즉 모두 만족할 수 없기에 CA, CP, AP로 구분되는데 P 즉 파티션 감내를 보장하기 위해서는 네트워크 장애가 절대 발생하면 안 된다는 가정이 필요하다. 그러나 <strong>통상 네트워크 장애는 피할 수 없다.</strong> 때문에 분산 시스템은 반드시 파티션 문제를 감내할 수 있도록 설계해야 하므로 실세계에서 <strong>CA시스템은 존재하지 않는다</strong>.</p>\n<p>즉, 저장소는 아래 요구사항 가운데 어느 것을 만족하냐에 따라 분류할 수 있다.</p>\n<ul>\n<li><strong>CP 시스템</strong>: 일관성, 파티션 감내를 지원, 가용성을 조금 포기한다.</li>\n<li><strong>AP 시스템</strong>: 가용성과 파티션 감내를 지원, 일관성을 조금 포기한다.</li>\n</ul>\n<p>그렇다면 가용성과 일관성 사이에서 Trade off를 해야 하기에 우리는 선택을 해야 한다.</p>\n<p>그렇게 문득 어떤 DB들은 어떤 요구사항을 따를까 궁금해져서 서칭을 시작했다.</p>\n<h2 id=\"mongo-db는-cp를-따른다\" style=\"position:relative;\"><a href=\"#mongo-db%EB%8A%94-cp%EB%A5%BC-%EB%94%B0%EB%A5%B8%EB%8B%A4\" aria-label=\"mongo db는 cp를 따른다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mongo DB는 CP를 따른다.</h2>\n<p>이 부분이 본격적으로 내가 의문을 갖게 된 시점이다. “mongoDB는 의심의 여지없이 AP일 것이라고 생각했거늘” 소리가 육성으로 나왔다. 물론 CP, AP 둘 중 하나에 쏠린 시스템은 좋지 않다. 그렇기에 대부분의 분산 시스템은 상황에 따라 일관성과 가용성의 우선순위를 다르게 설정한다. 그렇더라도 mongoDB의 특성이나 다양한 배경을 봤을 때 기본적으로 AP일 것이라고 생각했다. </p>\n<h2 id=\"pacelc-이론\" style=\"position:relative;\"><a href=\"#pacelc-%EC%9D%B4%EB%A1%A0\" aria-label=\"pacelc 이론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PACELC 이론</h2>\n<p>역시 세상에는 똑똑하신 분이 많다. CAP이론에는 내가 가진 의문과 같은 한계가 있기에 그 <strong>한계를 보완하고자 나온 PACELC이라는 이론이 있다</strong>고 한다.</p>\n<p>PACELC이론은 현실에서는 Partition 상황과 아닌(ELSE) 상황이 함께 존재한다고 가정하고, 2가지 상황을 나눠 각각 어떤 gaurantee를 선택할지 나누어 놓은 것이다.</p>\n<p>처음 소개했던 두 가지 상황에  Partition 상황인지 아닌지를 나누어 한번 더 요구사항을 분할한다.</p>\n<p><img src=\"https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&#x26;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcgiBVh%2FbtrmifvDEA1%2F0b7dpdNyBuaBteXxb44zuk%2Fimg.png\" alt=\"\"></p>\n<p>즉 구분을 다음과 같이 4가지로 나눌 수 있다.</p>\n<ul>\n<li>PA/EL 시스템: partition 상황에서는 가용성이 중요하고 <strong>일반적인 상황에서는 속도가 우선인 시스템</strong></li>\n<li>PA/EC 시스템: partition 상황에서는 가용성이 중요하고 <strong>일반적인 상황에서는 일관성이 우선인 시스템</strong></li>\n<li>PC/EL 시스템: partition이든 그 외든 <strong>일관성이 가장 중요한 시스템</strong></li>\n<li>PC/EC 시스템: partition 상황에서는 일관성을 중요하게 생각하고 그 외는 <strong>속도가 우선인 시스템</strong></li>\n</ul>\n<h2 id=\"mongodb는-paec를-따른다\" style=\"position:relative;\"><a href=\"#mongodb%EB%8A%94-paec%EB%A5%BC-%EB%94%B0%EB%A5%B8%EB%8B%A4\" aria-label=\"mongodb는 paec를 따른다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MongoDB는 PA/EC를 따른다.</h2>\n<p><img src=\"https://itwiki.kr/images/1/11/PACELC_%EB%B6%84%EB%A5%98.png\" alt=\"\"></p>\n<p>즉, 나는 분산환경에서 당연히 partition이 나누어져 있는 상황에서 MongoDB를 사용한다고 생각하여 일관성을 우선시한다는 말에 공감을 하지 못했던 것이다. 하지만 언제까지나 일반적인 상황에서는 <strong>일관성을 우선시하는 시스템</strong>이고 <strong>분산 환경에서는 가용성을 우선시한다.</strong></p>\n<p>그렇다면 분산 상황에서는 일관성을 보장하지 않는가 하면 또 그런 것도 아니다. Mongo DB는 Replica Set을 이용하여 클러스터를 구축한다. 이때, replication의 데이터 싱크가 비동기적으로 이루어지기 때문에 secondary에 복제되지 않은 데이터가 손실될 수 있다. 하지만 MongoDB는 <a href=\"https://mangkyu.tistory.com/53\">MVCC</a>(다중 버전 동시성 제어)라는 기법을 제공해 일관성도 수준급으로 보장한다. </p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>이렇듯 MongoDB는 CP다 일반적으로는 일관성을 중시하기 때문이다. 하지만 분산 환경에서는 AP다. partition 분할 시 가용성을 우선시하기 때문이다. 이렇게 좀 더 내용적으로 공부를 하고 나서야 의문이 풀렸다. 혹시라도 대규모 시스템 설계 기초 도서를 읽으며 나와 같은 의문을 가진 분께 조금이라도 도움이 되었으면 하는 마음이다.:)</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#cap%EC%9D%B4%EB%A1%A0-%EC%9D%B4%EB%9E%80\">CAP이론 이란?</a></li>\n<li><a href=\"#mongo-db%EB%8A%94-cp%EB%A5%BC-%EB%94%B0%EB%A5%B8%EB%8B%A4\">Mongo DB는 CP를 따른다.</a></li>\n<li><a href=\"#pacelc-%EC%9D%B4%EB%A1%A0\">PACELC 이론</a></li>\n<li><a href=\"#mongodb%EB%8A%94-paec%EB%A5%BC-%EB%94%B0%EB%A5%B8%EB%8B%A4\">MongoDB는 PA/EC를 따른다.</a></li>\n<li><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>\n</div>","frontmatter":{"date":"February 18, 2024","title":"뭐? Mongo DB가 가용성을 보장하지 않는다고?","categories":"Data_Engineering","author":"최지혁","emoji":"😮"},"fields":{"slug":"/Data Engineering/index1/"}},"prev":{"id":"ad2b72e4-7395-5707-be63-0e9e2ee54d97","html":"<h1 id=\"nat-인프라\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%ED%94%84%EB%9D%BC\" aria-label=\"nat 인프라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인프라</h1>\n<p>이번에 실시간 따릉이 대시보드 제작 프로젝트에 데이터 엔지니어 및 인프라로 참여하게 되었다.\n협업 및 배포의 용이성 때문에 클라우드를 이용하기로 결정이 났고 <font color=\"#c00000\">AWS에 EC2에 카프카 클러스터를 구축</font>하고 프로듀서를 개발하기로 하였다.<br>\n<br/></p>\n<p>AWS를 이용한 협업은 처음이기에 세세하게 사전조사를 했는데 첫째로 알게 된 사실은 AWS에서 네트워크를 설계할때 NAT의 사용은 필수적이라는 것이다.<br>\n<br/></p>\n<p>보안상 카프카 클러스터 서버들을 외부에서 접근할 수 없게 해야하기 때문이다.<br>\n<br/></p>\n<p>때문에 VPC 인프라를 구축할때 Public 서브넷과 Private 서브넷을 만들어 그안에 EC2 인스턴스를 두고, Bastion Host를 통해 Public 서브넷에서 Priavate 서브넷으로 접속한 후, NAT Gateway를 통해서 외부 인터넷 소스를 사설망에서 받는 식으로 운용된다.<br>\n<br/></p>\n<p>그만큼 중요한 것으로 당연히 AWS에도 관련 서비스인 NAT Gateway가 존재하고 그것을 이용해서 손쉽게 사설망 외부 통신을 하지만, 아주 중요한 사실이 있었으니…<br>\n<br/></p>\n<p>NAT 게이트웨이는 서울 지역 기준으로 시간당 0.059달러의 비용이 발생하는데, 이걸 24시간 가동하고 있으면 강제로 물린 삼성전자 주식을 다 팔아야할 수도 있다.<br>\n<br/></p>\n<p>때문에 NAT Gateway가 아닌 NAT instance를 사용할 수 있는데 물론 단점이 명확하지만 프리티어 요금제를 사용하면 <font color=\"#c00000\">무료</font>로도 사용가능하다.(무료가 포인트다^^)<br>\n<br/></p>\n<p>학생들이서 하는 토이 프로젝트이므로 퍼블릭 서브넷 기능 하나만 있으면 되기에 묻지도 따지지도 않고 NAT instance를 사용하기로 하였다.</p>\n<h1 id=\"nat-인스턴스-vs-gateway\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-vs-gateway\" aria-label=\"nat 인스턴스 vs gateway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 vs Gateway</h1>\n<p>NAT Instance는 EC2 Instance를 NAT용으로 바꿔 사용하는 것을 말한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxklEQVQoz3WT3YrTUBSF+7ze+AQ+i1fitQiDaL0pAzJ4IcNMwTJqHTKlSZvk/P+fk6XnnIxWqxuS7CySb6+9QhaYawKQUsRpTfh/CSEgpcQ4joixvjdNExb5JbF6Dt2s4SfAWQvnHKw1YJRgt9vh+3aLpmmw3+8hpSqQ3BNC0HVduQ8hFOgieAeyXsEc7mFcgNEa3jsce4I3yyuQ4YiRcXBG0R9a0KGHMaYMzVc7G8iOs9OF9x42na/knceXbw9Q2mBYvYA6NDWCKf4zggzPrAJUUpTEUvpNjt7lc+n3tx/Ahq7mFHx5Luf1eOTSZbMZGE/Sb9sWbdudfJIJ0riSbXAWKbg/rf0NtMbg6u0rcNJDMAYy9LBGwQiK28t30JyCjT2SM0AKEEOHm8sllGCQnNdNpggtRQU6a7BdfyoTOBuQoi8TnWRoNjcw1oHTI7y3s06LLqQqeorVsZZ8XtlZhFAh48VTqM1FXSWYX1sNr59A3S3PdPL+GcT1ywoU9NGhheS0iN3mI3h3X/rkdMkrJ9R+vgI/Ppzo1cDh6zXG3V3pFZ+BMQQwMkJxBm09lNJlgGQUkrPSV12d68ZBawPJCASnSD//lB87tU/LGyDnkQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/71b597b3b86ff7c7adc99bc1e0e52471/37523/AWS-VPC.png\"\n        srcset=\"/static/71b597b3b86ff7c7adc99bc1e0e52471/e9ff0/AWS-VPC.png 180w,\n/static/71b597b3b86ff7c7adc99bc1e0e52471/f21e7/AWS-VPC.png 360w,\n/static/71b597b3b86ff7c7adc99bc1e0e52471/37523/AWS-VPC.png 720w,\n/static/71b597b3b86ff7c7adc99bc1e0e52471/302a4/AWS-VPC.png 1080w,\n/static/71b597b3b86ff7c7adc99bc1e0e52471/07a9c/AWS-VPC.png 1440w,\n/static/71b597b3b86ff7c7adc99bc1e0e52471/332b4/AWS-VPC.png 1826w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n위 인프라는 이번에 내가 구성한 AWS 구성도다.\n인프라 구성을 보면, Public subnet에 NAT instance가 위치하게 된다. 그리고 <strong>EIP</strong>를 부여 받아 외부의 트래픽을 받는다.<br>\n<br/></p>\n<p>또한, Private 서브넷의 route table에 <strong>nat-instance-id</strong>를 설정하고 public-nat의 보안 그룹을 수정하여 private 서브넷에서 오는 모든 TCP 요청과 ICMP을 받도록 설정한다.<br>\n<br/></p>\n<blockquote>\n<p>EIP란?\n인스턴스를 재시작해도 public IP가 변경되지 않도록 고정된 public IP를 제공하는 서비스를 말함.</p>\n</blockquote>\n<br/>\n✅<font color=\"#c00000\">**NAT Instance**</font>: 퍼블릭 서브넷 기능이 있는 하나의 EC2 서버다. 때문에 꺼지면 죽으며 위 구성도 처럼 단일 서버로 구축하기 때문에 SPOF가 될 수 있다. 토이 프로젝트에서만 사용하도록 하자ㅎㅎ\n<p>✅<font color=\"#c00000\"><strong>NAT Gateway</strong></font>: AWS에서 제공하는 서비스이기에 고가용성이 보장되서 죽지 않는다. SPOF라는 단점을 해결할 수 있다.<br>\n<br/></p>\n<table>\n<thead>\n<tr>\n<th><strong>NAT Instance</strong></th>\n<th><strong>NAT Gateway</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>단일 인스턴스</td>\n<td>AWS에서 제공하는 서비스</td>\n</tr>\n<tr>\n<td>= EC2</td>\n<td>= 서비스</td>\n</tr>\n<tr>\n<td>서버가 꺼지면 죽음</td>\n<td>꺼져도 죽지 않음 병렬로 구성(고가용성 보장)</td>\n</tr>\n<tr>\n<td>보안그룹에 영향을 받기에 일일이 설정해야 함</td>\n<td>보안 그룹 영향 받지 않음</td>\n</tr>\n<tr>\n<td>Bastion을 겸할 수O</td>\n<td>Bastion을 겸할 수X</td>\n</tr>\n</tbody>\n</table>\n<br/>\n<h1 id=\"nat-instance를-구성-방법\" style=\"position:relative;\"><a href=\"#nat-instance%EB%A5%BC-%EA%B5%AC%EC%84%B1-%EB%B0%A9%EB%B2%95\" aria-label=\"nat instance를 구성 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT INSTANCE를 구성 방법</h1>\n<h4 id=\"서울리전-확인하기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EC%9A%B8%EB%A6%AC%EC%A0%84-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"서울리전 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서울리전 확인하기</h4>\n<ol>\n<li>서울리전으로 설정하기 않을경우 NW 트래픽 문제나 속도 이슈가 존재하므로 반드시 서울리전으로 설정한다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLUlEQVQ4y31Ty24TQRDcP4ELDwWRIAgPESRACEQOwIl7DKc43AhB/BPfwBUuAQ7hFgGJnPXajnfnvbMvF+re9dqxcFYqjaZnuqaquze4eHkNi7hwaRVXrt/Bys0N3HiwiWv3nmFtYxOr95+3uLr+BLcevsDtx6+w/uglY+XuUwRb2+/xf+xiq1ujQ+v2bhub7js7e3j77iPe7Oyh0/3ACLI8wzLked4gg0tTDEenGAyHiAYDJFKj/PYJ/c+v4b50UdgRfF4i0MZgEVIphpASiRBQSkNr3cYpFicSqvcT8u9X6N4+hIhhXYogyzJMQWpoNcbCWouDg1/Y//4Dh4e/0R9LPi+KAkIq/Dk6xnF4ilh5uGwCpQ0mkwmCqqowDwp675GmKax1UFqzQrI8K0GDzDO8T/ke5QdEMA/68rxgu9FgiH4U4eQkRBQNIKVCnAiOExIhkXrPjs4lJNvOOVZpjGH7aaOQVlI7c1GfUe2XKywKJIngRlDNqMuUSKqJqK5z3UAiI+WJlHUNl1lWSvFlerUsS/gsg3WOH6A9WSUUZcm1FucRkgJKpD0lE2mW5xidjjGOE7ZMZ9NGllW1aJl55hTmMGxR8ThoTbOp0Qv76IURx4mAJ0BrGOtmhA3TWYXNWMw/QrULQ+p2xPVsNPBHRG2XtS9QNUnT5OnMzceMz9Eba0TCQlhPJ2cctYSxMlxsGhPbgH4vsuxc2p5JYzGSFmNlkWjb3qdV6fp3JcJ/Bkc856zf6xwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/f715e028c2cabc8500c57e7ff19dc61e/37523/NAT1.png\"\n        srcset=\"/static/f715e028c2cabc8500c57e7ff19dc61e/e9ff0/NAT1.png 180w,\n/static/f715e028c2cabc8500c57e7ff19dc61e/f21e7/NAT1.png 360w,\n/static/f715e028c2cabc8500c57e7ff19dc61e/37523/NAT1.png 720w,\n/static/f715e028c2cabc8500c57e7ff19dc61e/302a4/NAT1.png 1080w,\n/static/f715e028c2cabc8500c57e7ff19dc61e/07a9c/NAT1.png 1440w,\n/static/f715e028c2cabc8500c57e7ff19dc61e/1e5d2/NAT1.png 1630w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h4 id=\"ec2-생성\" style=\"position:relative;\"><a href=\"#ec2-%EC%83%9D%EC%84%B1\" aria-label=\"ec2 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 생성</h4>\n<ol>\n<li>본격적으로 EC2를 생성해보자 애플리케이션은 일반 Linux 그리고 AMI는 기본으로 설정해주었다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACW0lEQVQ4y62UiW7bMAyG/f7P1wJtWqRrlMSHDkvWadnyP1BOg6XYgGGYgA/UZYoSf7q5XK54enrGy+sBg3ZYckaaZ8z/SGOMgXcWeU4o64qtlL+m3FjX9U7TSoMDG3DqR3A7Q/oM6W7431i/3DFxhQ4L1g331mjrIYzFoDRsnOFSvvM1vtuQoF3AaHesj5h8QIgJMe001lqcPj/BTgyXy6VyPp/BGEPbtrXfVcswSFU/nlNEIuJO/IUmhIATY2DsjK7v0fc92q7DtW0xcI6u69D3Ayh5fDSY84JlWZCX3X6nsc5h1AZq1NBklYaQClKNdY4LCdpjnYf3HpREWjNmelgftd6T4kOoG8gJLZL93nfOI8aEZaFMPmb1kYKG7j1Zi2myUOMIbUwd61sEZrL1QBqnNFeN/ol5zmhIR9zlyv9ojQsRbBhxHlR9CzrlIZKUagWQ/ZoPMdYE7MJeMVNRlBXbtqGxacUrG3DsTX14rRScD1BqxGQdtJ7Auah6U1rX55BcQnBRHcZcwFqOMK8gfTc+F7yfLjj1AlNacJki5hihtYalsvQj4pzghYAVHCFEXL3CM/tAWVZc5YSzMGiVxVoKGpc3tGrEYByMTzhzVQUqpYShiCYJFwIc59B9D+8DPkWLVsv6Zs65ehuy+5WdxyB1RZJMOK8SoVbKhlKw/wC2rV6J5IGyYbvJp9D8tt1tQ4I8HN5wPH7g5fUNx48fVXcUifO+JoD6X9AcaTfnXBMjhKwVNo56r2VaJBGT5tpuuAt64AL9wGtF0J7qiBzeDqPMU4TLTdTknBz+BGhNH2W3SkBlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/7348d2d09916134876ce93616c16fdd1/37523/NAT3.png\"\n        srcset=\"/static/7348d2d09916134876ce93616c16fdd1/e9ff0/NAT3.png 180w,\n/static/7348d2d09916134876ce93616c16fdd1/f21e7/NAT3.png 360w,\n/static/7348d2d09916134876ce93616c16fdd1/37523/NAT3.png 720w,\n/static/7348d2d09916134876ce93616c16fdd1/302a4/NAT3.png 1080w,\n/static/7348d2d09916134876ce93616c16fdd1/07a9c/NAT3.png 1440w,\n/static/7348d2d09916134876ce93616c16fdd1/5f78c/NAT3.png 1606w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br/>\n2. 서브넷 기능만 있으면 되기에 인스턴스 유형은 부분 무료인 t2.micro로 설정해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7UlEQVQY052Q4W6DMAyEef83XFVWYE1JCimUEEjiJFdhto79naVPVmzZOV9xPpc4fZxwaa5oBwuhDbz3/6Z4PicYY7CuDtYFhigixr+klN4cazElUIwgIs5F20pYa7FHZnLOSDl/DyZm+31dVyzLysNbzzuHSIRjFFVVs8J5njEMA57ThHEcsSmnEOC8Z3qt0UoJrTXssmAyFvW1heoeCBR3OTmjKJsbaiFRC4WyEfhsbhCqx+WrRSUk1L2D6nqm6x8IIbBaRwmjS+gtwfrDQjk56DngbjzTz4FR0/7eTv+xga1IifOvRXgv205+AZBf0SanurLBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/6facfec7bb869d05fbad23c38cc4830c/37523/NAT4.png\"\n        srcset=\"/static/6facfec7bb869d05fbad23c38cc4830c/e9ff0/NAT4.png 180w,\n/static/6facfec7bb869d05fbad23c38cc4830c/f21e7/NAT4.png 360w,\n/static/6facfec7bb869d05fbad23c38cc4830c/37523/NAT4.png 720w,\n/static/6facfec7bb869d05fbad23c38cc4830c/302a4/NAT4.png 1080w,\n/static/6facfec7bb869d05fbad23c38cc4830c/07a9c/NAT4.png 1440w,\n/static/6facfec7bb869d05fbad23c38cc4830c/5dded/NAT4.png 1588w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br/>\n3. 키페어를 pem파일로 만들어준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 408px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC2klEQVQ4y6VUWW/TQBD2P0ZIvMMDjxwFAVIlHpGAClXlUBEtBUKbNiFxDqc+0jhnkzaH0/iIj9iOPzSTtqogUAlW+nbXnt1vv5mdWWE2m8FxHPhBgOl0itHIgGXZ6PcHGI/HsCwLhjGGaZqYmCbOJhMYhoHZLASSGECMOApBPGEYQkCS4PXaG5z2+9ja3sHLV2tYXX2OGzdv4d79FTx4+Bi379zF5sdP2Hj7Hk+frWLl0ROc9Lr4IBt4kT3G0PIwPycViJUU0gcp6fVOUK83UCyVcXzcRTq9D0VRoet1NJstyLKCQrEEc3KGw56NbGOMydS/VMmENPE8D1EYIopCxHGMJEkQRRGPhPl8zv9pvLAhiX53mTqKj6ZpEEXxEqVSCeVyGYVCAZlMhv/lcjnUarWFR2GIIJjBD2ZMdgGBTqPL0HUdkiRBlmXepCoKqtUqH1SpVKAoMttarSZ83we1C/VXm0Cd5/mwbRumacG2HYzHZ3CcKSuh74XNhO0s5uRuFC3cpzmrI8WkkAj1RgvtThdfUntQtSO829xCs9WBVFHwfe8AYlFi6PUmtGoN1VodObGEmt6AdKiwTVarEIvlBSEFm05yXY/zixQuLsrHxLR4DIKAYzZ1XYYznfLoeh7bCbSfCUnN11Qa/cEQ/9uYkE477Q84RleD/S8Qfr2l6zZcrPmjwr8Zl7WrpEsVkrFSOYSmVbG+voFcXoSsqPiW2uX6pUXFYgnbn3e4FK9VSB3V8HA04pqlWh4ZBo5qOvL5AmdAqSxBUTV+eYgrjuecg8sg0Aa6jJDqFuCEpdSJ4phP9Hwfc3KHL8/lNDItG6ZlLYVAGT6ZmGi3O5CkCtL7B/yydLs9iGKRQ1GWKvzK8INwXdrQosFwhHxexEEmi0z2B1RVQ6vdQSq1i5pe5+dqd28frutiPk/YC/JsGQTym1zw/QDBLGR4fgDX8xGGEbtMFUL/LNs5d/fP+AlbJZsubVGxrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/50cfed78d04939a704f8c42edff5c92d/e7c18/NAT5.png\"\n        srcset=\"/static/50cfed78d04939a704f8c42edff5c92d/e9ff0/NAT5.png 180w,\n/static/50cfed78d04939a704f8c42edff5c92d/f21e7/NAT5.png 360w,\n/static/50cfed78d04939a704f8c42edff5c92d/e7c18/NAT5.png 408w\"\n        sizes=\"(max-width: 408px) 100vw, 408px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br/>\n4. vpc 설정해준다.</p>\n<ul>\n<li>기본 vpc</li>\n<li>나의 경우 bcd 서브넷에 카프카 브로커를 할당했으므로 a에 NAT을 할당해준다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAklEQVQ4y31Saa+bMBDM//9xfR+qp6p6zfVCEsAYHxgbH2SqXUKURFVXGi0YM3vMbLbbHT5+fODn5y+crzWMMcg5I70jZeRSoLVGJyVCmBBjBMXtduM8zzM2WhucLjU6ZTGFgBgTSilMkt9RCrwPcG5ETMu952BC6qi61Lg0Am0r0LQCIQTkXJBS4s4i57SQzDMj3QvEMiOkgjzfFkJrBxy/T9jtD9juD/g+VWhFh2vdoFca4+hhjIUdBhg7cCEa1XsPFybIMaG2E0KacbvN2EgpUVUV2qZBbz18pPHSY/T8hmWfiYnfgzrfCKlwaSWGkODDhGmKmGLkHKbpscs1UxHuMIRFkHdRRK/x+3DGtmrx3fTQxsDReMbAWMudEEkp80OsdCdeC7wQtnrA9tzgdG1xEhq1chBmRGNGKOtALhCdZCiteY90Rnlwju3zonLnC74ai91F4KocbAb0NEOGGT4VjM6x78gBzjn+ibp+3uFLh9YYnKszuk7ybujjMuICuvT8A4uTlxW8BxOSNcguQnTolUIne7bLMDjYwUHdx1uy5XN6J9C45FkyO7mCdrrx4witFHptoZRmMchjpWQUUpbMzFaJ/EyWKnk5Ww3PuLtgc6wlPv8csRcD+lCgQ4EKBb3PDPWUV5CZKf9z5CFEdMbBhcgiuCljjOW/WO+sgjyL8hekuj4fRRk4cgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/65822120e0b50de542ac26fcb3b46514/37523/NAT6.png\"\n        srcset=\"/static/65822120e0b50de542ac26fcb3b46514/e9ff0/NAT6.png 180w,\n/static/65822120e0b50de542ac26fcb3b46514/f21e7/NAT6.png 360w,\n/static/65822120e0b50de542ac26fcb3b46514/37523/NAT6.png 720w,\n/static/65822120e0b50de542ac26fcb3b46514/302a4/NAT6.png 1080w,\n/static/65822120e0b50de542ac26fcb3b46514/07a9c/NAT6.png 1440w,\n/static/65822120e0b50de542ac26fcb3b46514/ae28e/NAT6.png 1598w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br/>\n5. 인바운드 규칙 설정</p>\n<ul>\n<li>인바운드 규칙은 내 IP를 할당한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVQoz41R2W7EIAzM/3/hPmQfKnVZQggQ7iuZCqdbVZUqLRIa4cH2eDzN9ztutxvm+Q7Gnmit4TgO9N4Jz/N8647/AydrLYQQUErB+4AQAqFzDqUUvHOGCLFK5JwxKaWhfMFxXF1a64SDfHKOzUbk2r65huM8YYzBKjfoUH7ir8kmbQxiyhSo9SJSyvAhYJUSxjrszsH6C0OMhJvW0NbBeU9vYy1NNGmtsW4KeyxXUerWkVKC1DtMyKi1IJdCqgdnzA7OFyxihTABrVaKk8LhnfMBpQ6FlYrGlEjhg3N8PBg+GQPjCxjnUNrAOU+eyU2BC4kYE0038qeXsX+3NrwqtaDUSupa7/8u5XfeFy/eIB6c9h65AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/08ef9b8b74619827e1c2d8d30a385cad/37523/NAT7.png\"\n        srcset=\"/static/08ef9b8b74619827e1c2d8d30a385cad/e9ff0/NAT7.png 180w,\n/static/08ef9b8b74619827e1c2d8d30a385cad/f21e7/NAT7.png 360w,\n/static/08ef9b8b74619827e1c2d8d30a385cad/37523/NAT7.png 720w,\n/static/08ef9b8b74619827e1c2d8d30a385cad/302a4/NAT7.png 1080w,\n/static/08ef9b8b74619827e1c2d8d30a385cad/07a9c/NAT7.png 1440w,\n/static/08ef9b8b74619827e1c2d8d30a385cad/35890/NAT7.png 1582w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h4 id=\"eip-할당\" style=\"position:relative;\"><a href=\"#eip-%ED%95%A0%EB%8B%B9\" aria-label=\"eip 할당 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EIP 할당</h4>\n<ol>\n<li>VPC 접속</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABjUlEQVQoz3XR0XKaQBiGYS6jk0yrKBorCCuCQVgUFEIENSapduqM7SX0/o/eDotpO2Ny8Mwuy/Lvtz9a377nkz7ktmtx07XUeGuM/rrpWHzuOzhyjZAlTrRW3uYDf8X9ak+QPeOnO7SWPaczTumME3SRYEyW2LJShkGBLhZ0REJ7JN+ljyRfzFBpWRHaxJfc2TN0O1YbBt6S8eKRtiXRnTmdi64q/E/zPMeY5vSjil5Y0nVTND8/0JXP6iTdltx5D6TFb9z8G25c8TXcMgw3jVl1LdoylDtM+YTh5Wje4wmzONO2IpXSmOSI+S+C/EiwekXEe8ygwpxtsMLtFbN2edfzMrRpumMSr9W12nbMQCx4SXc45U+c9RlRnhkVJ+zkpfk4+sgOw12iTVd7RFw1DbZjeiIhjLb42QE/O+JlRyy5b9LMmqTXmnVjnKLF6wPufEN/sqQ1eku4xylOiOyIE22x6l4FJcOgekep1G1RBY1xQq3+a+1Lwjh+4r74wfThO9PsgJu8ftjD/9UF/wAjYymuXjTpFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/99898e3808f521553e77c4c687e03618/37523/NAT8.png\"\n        srcset=\"/static/99898e3808f521553e77c4c687e03618/e9ff0/NAT8.png 180w,\n/static/99898e3808f521553e77c4c687e03618/f21e7/NAT8.png 360w,\n/static/99898e3808f521553e77c4c687e03618/37523/NAT8.png 720w,\n/static/99898e3808f521553e77c4c687e03618/302a4/NAT8.png 1080w,\n/static/99898e3808f521553e77c4c687e03618/07a9c/NAT8.png 1440w,\n/static/99898e3808f521553e77c4c687e03618/a8979/NAT8.png 1828w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol start=\"2\">\n<li>탄력적 IP로 이동</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 185%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC80lEQVRIx7VWiXKqQBDM///Ue/WSGGM84oWCB+JtIiqHgGjSqZ4SShNBTNXbKoplxaF3erp37g6HA/wgQBjuwXk0gt0O+/0epyMIgnj+8fEh98/Pz7N37lbrNRpKG73+ALn8i1xPhSLKr3WUKlU85J7x998jlJaKSrWB+8c8HnIFrDfW5YCnC/zqduvBsm2EYSgIXXcLy3bg+T58P5C57bjJCKMFx3Exmy/gbrfIOr4HOwv49r5Eta5g8fYev3ztuojw0mLSy1lGjHC13qDZUtFUVBjDcZzTNDSpAfln23GwsWxJfpZ8pQZkjZFdc7WG47pSFktzBdNc/UCYFjwO+L400Wi2pf463T6UtoZSpYbHfOEqEVdJubVUEhGSkLbWxcAYoa12UGsogrZSrcs65fm9pE6fzwJSEcwZ69G2HcnncmnGa5uNdRFdolJoDJTafn8Q+XmeJ/LzPF+MguioJn6YpPGjUTVcRDgcjfFSesVwNEG11kShWEG3p6NWV4QcpoGEMQ2sV5qIbgx/BvwtKUnMn2m5pXagdXui575uCBG0NSLi8/7ol0lSPQtoWbZIbjKdCQHzxRtG46k4ENd5jww3leVLX4w0HI1TJ89ch9xSsVyNCXh6LkoKevoAD08FYfc7mtSALBcii5w4CHbYHV2b81OHzhSQdWWMxoKU+SNJaQxnkl6npwurrMXheHKV0dSAl8bhuE1ul8TchHA6m4sJFEoVOTKr9aaogmhpEDxO6ZWZA1KrTD71Sv3yzjU2AXJ8WvaZ21wnxXHEnWkKkVv7vv97P5xM57JNVetKJ1FvtoTtWw+r/+fY1C1RDYwhWm1NUM5mCykjrdvHaDK9jeWt50nemD82UDynuUazJUH8LamfSWA5xE6cORRiGIzsMuBpv5N5yz3dQC5fFPk1FPXozi08v5TFMKLe8KqWs5KStR2JEepLD/fdFf5oJuoTG0VjI8/yu6C6sbdZeyH6Sw+NqSN3deGiPLJuakMyb/mWOv0C6JBAxTFgDnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/fc606f1f97af047838417f697b1f5bb1/90372/NAT9.png\"\n        srcset=\"/static/fc606f1f97af047838417f697b1f5bb1/e9ff0/NAT9.png 180w,\n/static/fc606f1f97af047838417f697b1f5bb1/f21e7/NAT9.png 360w,\n/static/fc606f1f97af047838417f697b1f5bb1/90372/NAT9.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol start=\"3\">\n<li>탄력적 IP 생성</li>\n</ol>\n<ul>\n<li>설정 따로 필요 없고 기본으로 생성한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVQ4y51UiZKbMAzl/z+u3bbpNslODiCQkA0+wGCb63WkQNIy6e40nnljSdhPhyWCU5ZhtV4jDCMsV2/IRAHvG3jvn0JQVRWKogTtWmvU1qFt26cRmKrC5ZIjz3OI0qIfAAwDhk/Q9z0ercCYCpR2HB+QZu+wzsM59wE86tqiKA0TzB0FqjA4nTIIIWDK8u55wO0CRfxoDaP9L8KjLLEJYxwOCZL0CCEVmraFbxoGyQTn7zLZu9HxRHRLues61LaGqhxSbZHIiuV2vNi2VzSNh288nL+C7j1MmS7pssRFKghdjNDQpYHUGidRIM4No6wdk1rnmHBOxhFSzQjTASoeHxi9dwPQ9ITHdZzXNFBK8wtT21hrOdW6rq+wlm0k27rmXqWuIJ12+lYZw3ayUWDB+fyOL1+/YbF4xY/FTyxXa2y3O2x3O4RRhN1uz9iHIaIoxmazxZb0fYg4E1jHZ7wlF2hdYCBCqschPfILH6l9pOIoG36Q2SR03Uzv0XQDmq6/NXugtEZRlhBSQhcFzyOlQo7smDLLc32Sp7KMpQnS9IjXX0u8vHzn1Ch0ISSDZpwcsi4lqN6TLqWCVOouSwUaY55lSpOIyDON1eR1Grc/I7vrboS97fy3uabomN2MrzgMn7fIv1ZAEUVxgkOS4pILfoz5WP0PAiomEVEtlC5gqpp/sM8S/gYm/na2Nb4HRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/f97f15ae1bf37c7c65b779a61be4c03f/37523/NAT10.png\"\n        srcset=\"/static/f97f15ae1bf37c7c65b779a61be4c03f/e9ff0/NAT10.png 180w,\n/static/f97f15ae1bf37c7c65b779a61be4c03f/f21e7/NAT10.png 360w,\n/static/f97f15ae1bf37c7c65b779a61be4c03f/37523/NAT10.png 720w,\n/static/f97f15ae1bf37c7c65b779a61be4c03f/302a4/NAT10.png 1080w,\n/static/f97f15ae1bf37c7c65b779a61be4c03f/07a9c/NAT10.png 1440w,\n/static/f97f15ae1bf37c7c65b779a61be4c03f/7575b/NAT10.png 1608w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol start=\"4\">\n<li>탄력적 주소 IP 연결</li>\n</ol>\n<ul>\n<li>4개의 인스턴스 중 publc-NAT EC2와 연결한다.</li>\n<li>퍼블릭 NAT의 private IP주소를 연결한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZklEQVQ4y5WUCW/jNhBG9f9/WtHt7sZXbKe2JUvWLVGkDup8BRnbTdIDWAEPHI05DxAwn51v33/w2+/feFmt+f7zhbwoyPL8znv96OVFSSXl/+KYITOQpBlxklKUworSLLfvUZyQZOa3xPakUqi6RpnzK3WNk2U52+2Oy8XF864cDkde9wdbT+PIaBnsOQwDfd//J1prnKZpqKoKc/bDYJsGc2F8Cr8wTZ8ZR6ZpsjOOkIprcLOf3WlN27bPz5rnGfMsy/Kv8LEGK3Vy1eHeEtI0Q8qaaZrNPe6uX3qmacHRnaLMXZLoRJZc6JoU3aSMXcrQpnR1TFsnNCr+RKtie7et/67NnKO7kla84rs/CK4veOc/8LwVJ3/Pwd0RRHtkcSRPXhH5kSLdU2YHW1fFkSzekUY722vk+V049QHRbUMYrAn9FXG05xoe8cIjZXlG1y5KnKjlmUZeqIo3dOPBksAc30mYhxuObgV9G6KERyN9pPAQ+RlVXt4RLqq6IooLVekiS5c8NXKfZcxYxpRpMLKUoYtwMiF580IK1SKannZcLM1gmC2yG1B6fFL3k+3JViOltGuzzLPdU0fUHUGc4YcJtzglLQRZWZELSVEpe/bTgh5n+jum1tOCMlIpmT+ujYnMdvfKar1htdmw3mxZb7ccjm/s9nvOFxdZq39kVlQVutfPPX0KzSKbmL39ebKczmcrcV0P73rFu/rovreXP6ZluCeGr4tt0hHHCX4Q4Ac3rn5AcLsRRhFFURCGkY3lPC+M42SHTIKmef6UpKfQ5LYUwkrz/F1gMH9Xj1g9BA/Jg4foo/Av43PIZeFb4psAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/b73a382a0dcc2798f7cfd4e4544fa645/37523/NAT11.png\"\n        srcset=\"/static/b73a382a0dcc2798f7cfd4e4544fa645/e9ff0/NAT11.png 180w,\n/static/b73a382a0dcc2798f7cfd4e4544fa645/f21e7/NAT11.png 360w,\n/static/b73a382a0dcc2798f7cfd4e4544fa645/37523/NAT11.png 720w,\n/static/b73a382a0dcc2798f7cfd4e4544fa645/302a4/NAT11.png 1080w,\n/static/b73a382a0dcc2798f7cfd4e4544fa645/07a9c/NAT11.png 1440w,\n/static/b73a382a0dcc2798f7cfd4e4544fa645/dca52/NAT11.png 1550w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVQY05WR207EMAxE+/8/iLZol8Km9EKb5tI0dpp0UIIoyxNipKMZv4wsu3LOoesHEDOIGDHGf7HvOzwRUkrIqty2oet69P0AYwxCCAjMCIHB/DfObZjlUopLobYrrq8tGtFhmBUW6yDNCmU30J5O+DHH4yQdOHUcByrlGJfmHU/1FfXtDZeXO+pGQIwSlnZoH2D8j2fUxmVuJw3jw1lWNpxmiedbg7zpog0WY7/IWVvMiyrkWSqNSSrY1cETY/OEGNPvwnyzcfyAEG25412IkrN778ujsjMHEFHJKUY86rssF34C0CzQdn0hjH0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/184c45277371d239ba75209d2f4cd633/37523/NAT12.png\"\n        srcset=\"/static/184c45277371d239ba75209d2f4cd633/e9ff0/NAT12.png 180w,\n/static/184c45277371d239ba75209d2f4cd633/f21e7/NAT12.png 360w,\n/static/184c45277371d239ba75209d2f4cd633/37523/NAT12.png 720w,\n/static/184c45277371d239ba75209d2f4cd633/302a4/NAT12.png 1080w,\n/static/184c45277371d239ba75209d2f4cd633/07a9c/NAT12.png 1440w,\n/static/184c45277371d239ba75209d2f4cd633/3ceac/NAT12.png 1456w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>이렇게 하면 간단하게 NAT 인스터스 생성이 가능하다. 이제 이 퍼블릭 서버 내부에 프라이빗 서 버 key 값을 scp 명령어로 집어 넣고 본격적으로 카프카 클러스터를 구축이 가능하다.</p>","frontmatter":{"date":"April 14, 2024","title":"AWS NAT instance를 활용한 비용절약","categories":"Cloud","author":"최지혁","emoji":"🐕"},"fields":{"slug":"/Cloud/"}},"site":{"siteMetadata":{"siteUrl":"https://statisticsfox.github.io","comments":{"utterances":{"repo":"StatisticsFox/blog-comments"}}}}},"pageContext":{"slug":"/Data Engineering/","nextSlug":"/Data Engineering/index1/","prevSlug":"/Cloud/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}