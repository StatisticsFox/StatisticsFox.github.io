{"componentChunkName":"component---src-templates-blog-template-js","path":"/error/","result":{"data":{"cur":{"id":"a072a1f4-cdc0-5328-a338-4ba99b967d9e","html":"<h1 id=\"aws---jammy-inrelease--101-network-is-unreachable\" style=\"position:relative;\"><a href=\"#aws---jammy-inrelease--101-network-is-unreachable\" aria-label=\"aws   jammy inrelease  101 network is unreachable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS - jammy InRelease &#x26; 101: Network is unreachable</h1>\n<h2 id=\"jammy-inrelease-오류\" style=\"position:relative;\"><a href=\"#jammy-inrelease-%EC%98%A4%EB%A5%98\" aria-label=\"jammy inrelease 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jammy InRelease 오류</h2>\n<p>카프카 브로커 Ubuntu 서버에 java를 설치하려고 하는데 아래와 같은 문구가 뜨면서 동작이 되지 않았다. 무슨 jammy가 inrelease된 것 같은데 재미 하나도 없고 머리 아프다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ign: 1 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy InRelease\nIgn: 2 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease \nIgn: 3 http://ap-northeast-2.ec2.archive.ubuntu.com/ubuntu jammy-backports\nCannot initiate the connection to ap-northeast-2.ec2.archive.ubuntu.com:80 (2406:da12:944:ae00:128:62c8:e? ). - connect (101: Network is unreachable)</code></pre></div>\n<p>다행히도 해당 에러에 대해서는 AWS측에서 답변 달아준 부분 있다.\n<img src=\"https://i.imgur.com/wkAzaAh.png\" alt=\"\"></p>\n<h3 id=\"공식-해결-방법\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EC%8B%9D-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"공식 해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공식 해결 방법</h3>\n<p>대충 해석을 보면 아래의 포인트들을 다시 체크해봐라 같은데 해석해보면 다음과 같다.</p>\n<ul>\n<li>현재 EC2가 제대로 작동하는 다른 EC2들과 <font color=\"#c00000\">동일한 VPC 및 서브넷에 배포되었는가</font>?</li>\n<li>그게 아니라면 VPC가 <font color=\"#c00000\">인터넷 게이트웨이로 인터넷에 접근이 허용</font>되어 있는가?</li>\n<li>서브넷이 public이라면 인터넷 바운드 트레픽을 <font color=\"#c00000\">인터넷 게이트 웨이로 라우팅</font><font color=\"#c00000\">하는</font> <font color=\"#c00000\">라우팅 테이블이 있는가</font>?</li>\n<li>서브넷이 private이라면 인터넷 바운드 트래픽을 공용 서브넷의 <font color=\"#c00000\">NAT 게이트 위에이로 라우팅하는 라우팅 테이블이 있는가</font>?</li>\n</ul>\n<h3 id=\"체크리스트\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8\" aria-label=\"체크리스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체크리스트</h3>\n<p>첫째로, EC2는 <font color=\"#245bdb\">동일한 VPC에 배포</font>되었으며 각각의 브로커 서브넷은 private로 두기 위해 종류를 다르게 하였다.\n둘째로, 나는 비용절감을 위해<font color=\"#245bdb\"> NAT Instance를 구축</font>했고 public NAT 서버는 라우팅 테이블이 잘 설정되어 있으며 <font color=\"#245bdb\">라우팅 테이블은 3개의 브로커 서브넷을 잘 가리키고 있었다.</font>\n셋째로 브로커 private 서브넷의 <font color=\"#245bdb\">바운드 규칙 또한 public NAT에 잘 뚫어준 것도  확인</font>했다.</p>\n<p>따라서 해당사항은 없다고 생각했다. 때문에 같이 나온 에러인 <font color=\"#c00000\">80번 포트 접속에 대한 101 에러에 대해서 탐색</font>해보기로 했다.</p>\n<h2 id=\"101-network-is-unreachable-오류\" style=\"position:relative;\"><a href=\"#101-network-is-unreachable-%EC%98%A4%EB%A5%98\" aria-label=\"101 network is unreachable 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>101: Network is unreachable 오류</h2>\n<p>해당 사항에 대해서는 구글링 및 AWS 답변을 찾아본 결과 80번 포트가 막혀있어서 그렇단다. 때문에 public nat의 인바운드와 아웃바운드 규칙을 잠시 모든 TCP에 대하여 허용해주었다.\n하지만 여전히 같은 에러가 났다…</p>\n<h1 id=\"오류-해결-방법\" style=\"position:relative;\"><a href=\"#%EC%98%A4%EB%A5%98-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"오류 해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오류 해결 방법</h1>\n<h2 id=\"iptable-설정하기\" style=\"position:relative;\"><a href=\"#iptable-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"iptable 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IPtable 설정하기</h2>\n<p>이렇게 허무할 수가, 알고보니 iptable 설정이 잘 못 되어 있었다… 인프라 설정 덕분에 3시간이 날아가 버렸다..</p>\n<blockquote>\n<p>iptable이란?\n리눅스에 저장된 네트워크 패킷 필터링 시스템으로 네트워크 트래픽을 관리하여 패킷을 허용하거나 차단할 수 있다.</p>\n</blockquote>\n<p>아래처럼 iptable을 설치해주면 이제 인터넷 연결이 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> iptables-services <span class=\"token parameter variable\">-y</span>\n$ <span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> iptables\n$ <span class=\"token function\">sudo</span> systemctl start iptables\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">vi</span> /etc/sysctl.d/custom-ip-forwarding.conf\n<span class=\"token assign-left variable\">net.ipv4.ip_forward</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">-p</span> /etc/sysctl.d/custom-ip-forwarding.conf\n$ <span class=\"token function\">sudo</span> /sbin/iptables <span class=\"token parameter variable\">-t</span> nat <span class=\"token parameter variable\">-A</span> POSTROUTING <span class=\"token parameter variable\">-o</span> enXO <span class=\"token parameter variable\">-j</span> MASQUERADE\n$ <span class=\"token function\">sudo</span> /sbin/iptables <span class=\"token parameter variable\">-F</span> FORWARD\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">service</span> iptables</code></pre></div>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>AWS는 삽질을 통한 깨달음을 얻어야 한다!! 해결됐을때 그 시원함도 너무 좋다.</p>","excerpt":"AWS - jammy InRelease & 101: Network is unreachable jammy InRelease 오류 카프카 브로커 Ubuntu 서버에 java를 설치하려고 하는데 아래와 같은 문구가 뜨면서 동작이 되지 않았다. 무슨 jammy가 inrelease된 것 같은데 재미 하나도 없고 머리 아프다 다행히도 해당 에러에 대해서는 AWS측에서 답변 달아준 부분 있다.\n 공식 해결 방법 대충 해석을 보면 아래의 포인트들을 다시 체크해봐라 같은데 해석해보면 다음과 같다. 현재 EC2가 제대로 작동하는 다른 EC2들과 동일한 VPC 및 서브넷에 배포되었는가? 그게 아니라면 VPC가 인터넷 게이트웨이로 인터넷에 접근이 허용되어 있는가? 서브넷이 public이라면 인터넷 바운드 트레픽을 인터넷 게이트 웨이로 라우팅하는 라우팅 테이블이 있는가? 서브넷이 private이라면 인터넷 바운드 트래픽을 공용 서브넷의 NAT 게이트 위에이로 라우팅하는 라우팅 테이블이 있는가? 체크리스트…","frontmatter":{"date":"April 16, 2024","title":"AWS - jammy InRelease & 101 Network is unreachable 해결하기","categories":"ERROR Cloud","author":"최지혁","emoji":"🧰"},"fields":{"slug":"/error/"}},"next":{"id":"ad2b72e4-7395-5707-be63-0e9e2ee54d97","html":"<h1 id=\"nat-인프라\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%ED%94%84%EB%9D%BC\" aria-label=\"nat 인프라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인프라</h1>\n<p>이번에 실시간 따릉이 대시보드 제작 프로젝트에 데이터 엔지니어 및 인프라로 참여하게 되었다.\n협업 및 배포의 용이성 때문에 클라우드를 이용하기로 결정이 났고 <font color=\"#c00000\">AWS에 EC2에 카프카 클러스터를 구축</font>하고 프로듀서를 개발하기로 하였다.<br>\n<br/></p>\n<p>AWS를 이용한 협업은 처음이기에 세세하게 사전조사를 했는데 첫째로 알게 된 사실은 AWS에서 네트워크를 설계할때 NAT의 사용은 필수적이라는 것이다.<br>\n<br/></p>\n<p>보안상 카프카 클러스터 서버들을 외부에서 접근할 수 없게 해야하기 때문이다.<br>\n<br/></p>\n<p>때문에 VPC 인프라를 구축할때 Public 서브넷과 Private 서브넷을 만들어 그안에 EC2 인스턴스를 두고, Bastion Host를 통해 Public 서브넷에서 Priavate 서브넷으로 접속한 후, NAT Gateway를 통해서 외부 인터넷 소스를 사설망에서 받는 식으로 운용된다.<br>\n<br/></p>\n<p>그만큼 중요한 것으로 당연히 AWS에도 관련 서비스인 NAT Gateway가 존재하고 그것을 이용해서 손쉽게 사설망 외부 통신을 하지만, 아주 중요한 사실이 있었으니…<br>\n<br/></p>\n<p>NAT 게이트웨이는 서울 지역 기준으로 시간당 0.059달러의 비용이 발생하는데, 이걸 24시간 가동하고 있으면 강제로 물린 삼성전자 주식을 다 팔아야할 수도 있다.<br>\n<br/></p>\n<p>때문에 NAT Gateway가 아닌 NAT instance를 사용할 수 있는데 물론 단점이 명확하지만 프리티어 요금제를 사용하면 <font color=\"#c00000\">무료</font>로도 사용가능하다.(무료가 포인트다^^)<br>\n<br/></p>\n<p>학생들이서 하는 토이 프로젝트이므로 퍼블릭 서브넷 기능 하나만 있으면 되기에 묻지도 따지지도 않고 NAT instance를 사용하기로 하였다.</p>\n<h1 id=\"nat-인스턴스-vs-gateway\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-vs-gateway\" aria-label=\"nat 인스턴스 vs gateway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 vs Gateway</h1>\n<p>NAT Instance는 EC2 Instance를 NAT용으로 바꿔 사용하는 것을 말한다.</p>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21175&#x26;authkey=%21ACJyVPKOV4xFRFw&#x26;width=1826&#x26;height=1018\" alt=\"사진\">\n위 인프라는 이번에 내가 구성한 AWS 구성도다.\n인프라 구성을 보면, Public subnet에 NAT instance가 위치하게 된다. 그리고 <strong>EIP</strong>를 부여 받아 외부의 트래픽을 받는다.<br>\n<br/></p>\n<p>또한, Private 서브넷의 route table에 <strong>nat-instance-id</strong>를 설정하고 public-nat의 보안 그룹을 수정하여 private 서브넷에서 오는 모든 TCP 요청과 ICMP을 받도록 설정한다.<br>\n<br/></p>\n<blockquote>\n<p>EIP란?\n인스턴스를 재시작해도 public IP가 변경되지 않도록 고정된 public IP를 제공하는 서비스를 말함.</p>\n</blockquote>\n<br/>\n✅<font color=\"#c00000\">**NAT Instance**</font>: 퍼블릭 서브넷 기능이 있는 하나의 EC2 서버다. 때문에 꺼지면 죽으며 위 구성도 처럼 단일 서버로 구축하기 때문에 SPOF가 될 수 있다. 토이 프로젝트에서만 사용하도록 하자ㅎㅎ\n<p>✅<font color=\"#c00000\"><strong>NAT Gateway</strong></font>: AWS에서 제공하는 서비스이기에 고가용성이 보장되서 죽지 않는다. SPOF라는 단점을 해결할 수 있다.<br>\n<br/></p>\n<table>\n<thead>\n<tr>\n<th><strong>NAT Instance</strong></th>\n<th><strong>NAT Gateway</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>단일 인스턴스</td>\n<td>AWS에서 제공하는 서비스</td>\n</tr>\n<tr>\n<td>= EC2</td>\n<td>= 서비스</td>\n</tr>\n<tr>\n<td>서버가 꺼지면 죽음</td>\n<td>꺼져도 죽지 않음 병렬로 구성(고가용성 보장)</td>\n</tr>\n<tr>\n<td>보안그룹에 영향을 받기에 일일이 설정해야 함</td>\n<td>보안 그룹 영향 받지 않음</td>\n</tr>\n<tr>\n<td>Bastion을 겸할 수O</td>\n<td>Bastion을 겸할 수X</td>\n</tr>\n</tbody>\n</table>\n<br/>\n<h1 id=\"nat-instance를-구성-방법\" style=\"position:relative;\"><a href=\"#nat-instance%EB%A5%BC-%EA%B5%AC%EC%84%B1-%EB%B0%A9%EB%B2%95\" aria-label=\"nat instance를 구성 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT INSTANCE를 구성 방법</h1>\n<h4 id=\"서울리전-확인하기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EC%9A%B8%EB%A6%AC%EC%A0%84-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"서울리전 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서울리전 확인하기</h4>\n<ol>\n<li>서울리전으로 설정하기 않을경우 NW 트래픽 문제나 속도 이슈가 존재하므로 반드시 서울리전으로 설정한다.</li>\n</ol>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21180&#x26;authkey=%21APvwedKCHFgQ6Kw&#x26;width=1630&#x26;height=1224\" alt=\"사진\"></p>\n<h4 id=\"ec2-생성\" style=\"position:relative;\"><a href=\"#ec2-%EC%83%9D%EC%84%B1\" aria-label=\"ec2 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 생성</h4>\n<ol>\n<li>본격적으로 EC2를 생성해보자 애플리케이션은 일반 Linux 그리고 AMI는 기본으로 설정해주었다.</li>\n</ol>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21178&#x26;authkey=%21AKRzq5kdXgvkcic&#x26;width=1606&#x26;height=1390\" alt=\"사진\">\n<br/>\n2. 서브넷 기능만 있으면 되기에 인스턴스 유형은 부분 무료인 t2.micro로 설정해준다.</p>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21181&#x26;authkey=%21AKxVZWn1CiOmH5o&#x26;width=1588&#x26;height=460\" alt=\"사진\">\n<br/>\n3. 키페어를 pem파일로 만들어준다.</p>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21182&#x26;authkey=%21APgiOuyNKz-W50M&#x26;width=408&#x26;height=394\" alt=\"사진\">\n<br/>\n4. vpc 설정해준다.</p>\n<ul>\n<li>기본 vpc</li>\n<li>나의 경우 bcd 서브넷에 카프카 브로커를 할당했으므로 a에 NAT을 할당해준다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21183&#x26;authkey=%21AGgbEYqNyIHczdo&#x26;width=1598&#x26;height=1156\" alt=\"사진\">\n<br/>\n5. 인바운드 규칙 설정</p>\n<ul>\n<li>인바운드 규칙은 내 IP를 할당한다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21184&#x26;authkey=%21AH8QcDiiKDJCK4c&#x26;width=1582&#x26;height=552\" alt=\"사진\"></p>\n<h4 id=\"eip-할당\" style=\"position:relative;\"><a href=\"#eip-%ED%95%A0%EB%8B%B9\" aria-label=\"eip 할당 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EIP 할당</h4>\n<ol>\n<li>VPC 접속</li>\n</ol>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21186&#x26;authkey=%21AKPEtJmL7a-EvMQ&#x26;width=1828&#x26;height=788\" alt=\"사진\"></p>\n<ol start=\"2\">\n<li>탄력적 IP로 이동</li>\n</ol>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21185&#x26;authkey=%21AO8AgBJvSrgK1QE&#x26;width=468&#x26;height=866\" alt=\"사진\"></p>\n<ol start=\"3\">\n<li>탄력적 IP 생성</li>\n</ol>\n<ul>\n<li>설정 따로 필요 없고 기본으로 생성한다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21187&#x26;authkey=%21AAr_8clA47VSufc&#x26;width=1608&#x26;height=1454\" alt=\"사진\"></p>\n<ol start=\"4\">\n<li>탄력적 주소 IP 연결</li>\n</ol>\n<ul>\n<li>4개의 인스턴스 중 publc-NAT EC2와 연결한다.</li>\n<li>퍼블릭 NAT의 private IP주소를 연결한다.</li>\n</ul>\n<p><img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21188&#x26;authkey=%21AO2xww8Kgkg1rMo&#x26;width=1550&#x26;height=1250\" alt=\"사진\">\n<img src=\"https://onedrive.live.com/embed?resid=9DED56BE8CF81C92%21189&#x26;authkey=%21AHnhNMasptV-XKk&#x26;width=1456&#x26;height=466\" alt=\"사진\"></p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>이렇게 하면 간단하게 NAT 인스터스 생성이 가능하다. 이제 이 퍼블릭 서버 내부에 프라이빗 서 버 key 값을 scp 명령어로 집어 넣고 본격적으로 카프카 클러스터를 구축이 가능하다.</p>","frontmatter":{"date":"April 14, 2024","title":"AWS NAT instance를 활용한 비용절약","categories":"Cloud","author":"최지혁","emoji":"🐕"},"fields":{"slug":"/Cloud/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://statisticsfox.github.io","comments":{"utterances":{"repo":"StatisticsFox/blog-comments"}}}}},"pageContext":{"slug":"/error/","nextSlug":"/Cloud/","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}